<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Bayesian Quantile Regression | Stan Bookdown</title>
  <meta name="description" content="Chapter 6 Bayesian Quantile Regression | Stan Bookdown" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Bayesian Quantile Regression | Stan Bookdown" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Bayesian Quantile Regression | Stan Bookdown" />
  
  
  

<meta name="author" content="Kamran Afzali" />


<meta name="date" content="2025-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-regularized-regression.html"/>
<link rel="next" href="bayesian-multilevel-regression-in-stan.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stan</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Choosing the Right Bayesian Model</a></li>
<li class="chapter" data-level="2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html"><i class="fa fa-check"></i><b>2</b> Bayesian Modeling in R and Stan</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#what-is-stan"><i class="fa fa-check"></i><b>2.1</b> What is <code>stan</code>?</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#model-file"><i class="fa fa-check"></i><b>2.2</b> Model file</a></li>
<li class="chapter" data-level="2.3" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#fit-the-model"><i class="fa fa-check"></i><b>2.3</b> Fit the model</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#mcmc-diagnostics"><i class="fa fa-check"></i><b>2.4</b> MCMC diagnostics</a></li>
<li class="chapter" data-level="2.5" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#conclusions"><i class="fa fa-check"></i><b>2.5</b> Conclusions</a></li>
<li class="chapter" data-level="2.6" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#references"><i class="fa fa-check"></i><b>2.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html"><i class="fa fa-check"></i><b>3</b> Bayesian Regression Models for Non-Normal Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#logistic-regression"><i class="fa fa-check"></i><b>3.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#negative-binomial"><i class="fa fa-check"></i><b>3.2</b> Negative Binomial</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
<li class="chapter" data-level="3.4" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#references-1"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="robust-t-regression.html"><a href="robust-t-regression.html"><i class="fa fa-check"></i><b>4</b> Robust t-regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="robust-t-regression.html"><a href="robust-t-regression.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="robust-t-regression.html"><a href="robust-t-regression.html#concepts-and-code"><i class="fa fa-check"></i><b>4.2</b> Concepts and code</a></li>
<li class="chapter" data-level="4.3" data-path="robust-t-regression.html"><a href="robust-t-regression.html#conclusion-1"><i class="fa fa-check"></i><b>4.3</b> Conclusion</a></li>
<li class="chapter" data-level="4.4" data-path="robust-t-regression.html"><a href="robust-t-regression.html#references-2"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html"><i class="fa fa-check"></i><b>5</b> Bayesian Regularized Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#ridge-regression-and-gaussian-priors"><i class="fa fa-check"></i><b>5.2</b> Ridge Regression and Gaussian Priors</a></li>
<li class="chapter" data-level="5.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#lasso-regression-and-laplace-priors"><i class="fa fa-check"></i><b>5.3</b> LASSO Regression and Laplace Priors</a></li>
<li class="chapter" data-level="5.4" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#hierarchical-shrinkage-and-adaptive-priors"><i class="fa fa-check"></i><b>5.4</b> Hierarchical Shrinkage and Adaptive Priors</a></li>
<li class="chapter" data-level="5.5" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#implementation"><i class="fa fa-check"></i><b>5.5</b> Implementation</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-ridge-regression"><i class="fa fa-check"></i><b>5.5.1</b> Bayesian Ridge Regression</a></li>
<li class="chapter" data-level="5.5.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-lasso-regression"><i class="fa fa-check"></i><b>5.5.2</b> Bayesian LASSO Regression</a></li>
<li class="chapter" data-level="5.5.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#hierarchical-shrinkage-horseshoe-prior"><i class="fa fa-check"></i><b>5.5.3</b> Hierarchical Shrinkage (Horseshoe Prior)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#empirical-comparison-and-model-evaluation"><i class="fa fa-check"></i><b>5.6</b> Empirical Comparison and Model Evaluation</a></li>
<li class="chapter" data-level="5.7" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#understanding-posterior-behavior"><i class="fa fa-check"></i><b>5.7</b> Understanding Posterior Behavior</a></li>
<li class="chapter" data-level="5.8" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#choosing-among-regularization-methods"><i class="fa fa-check"></i><b>5.8</b> Choosing Among Regularization Methods</a></li>
<li class="chapter" data-level="5.9" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#conclusion-2"><i class="fa fa-check"></i><b>5.9</b> Conclusion</a></li>
<li class="chapter" data-level="5.10" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#references-3"><i class="fa fa-check"></i><b>5.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html"><i class="fa fa-check"></i><b>6</b> Bayesian Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#introduction-2"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#model-specification"><i class="fa fa-check"></i><b>6.2</b> Model Specification</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-bayesqr-package"><i class="fa fa-check"></i><b>6.2.1</b> Using bayesQR package</a></li>
<li class="chapter" data-level="6.2.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-brms-package"><i class="fa fa-check"></i><b>6.2.2</b> Using brms package</a></li>
<li class="chapter" data-level="6.2.3" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#backend-stan-model"><i class="fa fa-check"></i><b>6.2.3</b> Backend stan model</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#conclusion-3"><i class="fa fa-check"></i><b>6.3</b> Conclusion</a></li>
<li class="chapter" data-level="6.4" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#references-4"><i class="fa fa-check"></i><b>6.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html"><i class="fa fa-check"></i><b>7</b> Bayesian Multilevel Regression in Stan</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#implementation-1"><i class="fa fa-check"></i><b>7.2</b> Implementation</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#random-intercepts-model-modeling-baseline-differences"><i class="fa fa-check"></i><b>7.2.1</b> Random Intercepts Model: Modeling Baseline Differences</a></li>
<li class="chapter" data-level="7.2.2" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#random-slopes-model-capturing-varying-effects"><i class="fa fa-check"></i><b>7.2.2</b> Random Slopes Model: Capturing Varying Effects</a></li>
<li class="chapter" data-level="7.2.3" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#model-comparison-and-visualization"><i class="fa fa-check"></i><b>7.2.3</b> Model Comparison and Visualization</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#advanced-visualization-and-interpretation"><i class="fa fa-check"></i><b>7.3</b> Advanced Visualization and Interpretation</a></li>
<li class="chapter" data-level="7.4" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#conclusion-and-practical-recommendations"><i class="fa fa-check"></i><b>7.4</b> Conclusion and Practical Recommendations</a></li>
<li class="chapter" data-level="7.5" data-path="bayesian-multilevel-regression-in-stan.html"><a href="bayesian-multilevel-regression-in-stan.html#references-5"><i class="fa fa-check"></i><b>7.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html"><i class="fa fa-check"></i><b>8</b> Gaussian Process Regression (GPR)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#introduction-4"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#challenges"><i class="fa fa-check"></i><b>8.2</b> Challenges</a></li>
<li class="chapter" data-level="8.3" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#gpfit-package"><i class="fa fa-check"></i><b>8.3</b> GPfit package</a></li>
<li class="chapter" data-level="8.4" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#bayesian-stan"><i class="fa fa-check"></i><b>8.4</b> Bayesian Stan</a></li>
<li class="chapter" data-level="8.5" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#references-6"><i class="fa fa-check"></i><b>8.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html"><i class="fa fa-check"></i><b>9</b> Bayesian Gaussian Mixture Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#single-varaible-example"><i class="fa fa-check"></i><b>9.1</b> Single varaible example</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#example-with-multiple-variable"><i class="fa fa-check"></i><b>9.2</b> Example with multiple variable</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#conclusion-4"><i class="fa fa-check"></i><b>9.3</b> Conclusion</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#references-7"><i class="fa fa-check"></i><b>9.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html"><i class="fa fa-check"></i><b>10</b> Bayesian Canonical Correlation Analysis in Stan</a>
<ul>
<li class="chapter" data-level="10.1" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#introduction-5"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>10.1.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="10.1.2" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#stan-model"><i class="fa fa-check"></i><b>10.1.2</b> Stan Model</a></li>
<li class="chapter" data-level="10.1.3" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#model-validation-on-test-set"><i class="fa fa-check"></i><b>10.1.3</b> Model validation on test set</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#conclusion-5"><i class="fa fa-check"></i><b>10.2</b> Conclusion</a></li>
<li class="chapter" data-level="10.3" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#references-8"><i class="fa fa-check"></i><b>10.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>11</b> Bayesian Seasonal Decomposition in Stan and RStan</a>
<ul>
<li class="chapter" data-level="11.1" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#simulating-seasonal-time-series-data"><i class="fa fa-check"></i><b>11.1</b> Simulating Seasonal Time Series Data*</a></li>
<li class="chapter" data-level="11.2" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#bayesian-seasonal-decomposition-model-in-stan"><i class="fa fa-check"></i><b>11.2</b> Bayesian Seasonal Decomposition Model in Stan</a></li>
<li class="chapter" data-level="11.3" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#fitting-the-model-in-r"><i class="fa fa-check"></i><b>11.3</b> Fitting the Model in R</a></li>
<li class="chapter" data-level="11.4" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extracting-and-visualizing-components"><i class="fa fa-check"></i><b>11.4</b> Extracting and Visualizing Components</a></li>
<li class="chapter" data-level="11.5" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extensions-and-applications"><i class="fa fa-check"></i><b>11.5</b> Extensions and Applications</a></li>
<li class="chapter" data-level="11.6" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#conclusion-6"><i class="fa fa-check"></i><b>11.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>12</b> Bayesian Exponential Smoothing and Holt-Winters Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-simple-exponential-smoothing-ses"><i class="fa fa-check"></i><b>12.1</b> Bayesian Simple Exponential Smoothing (SES)</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model-1"><i class="fa fa-check"></i><b>12.1.1</b> Stan Model</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fitting-in-r"><i class="fa fa-check"></i><b>12.1.2</b> Fitting in R</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization"><i class="fa fa-check"></i><b>12.1.3</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-holt-winters-models"><i class="fa fa-check"></i><b>12.2</b> Bayesian Holt-Winters Models</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#without-seasonality-additive-trend"><i class="fa fa-check"></i><b>12.2.1</b> Without Seasonality (Additive Trend)</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model-2"><i class="fa fa-check"></i><b>12.2.2</b> Stan Model</a></li>
<li class="chapter" data-level="12.2.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-1"><i class="fa fa-check"></i><b>12.2.3</b> Visualization</a></li>
<li class="chapter" data-level="12.2.4" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#with-seasonality-additive-seasonal-component"><i class="fa fa-check"></i><b>12.2.4</b> With Seasonality (Additive Seasonal Component)</a></li>
<li class="chapter" data-level="12.2.5" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fit"><i class="fa fa-check"></i><b>12.2.5</b> Fit</a></li>
<li class="chapter" data-level="12.2.6" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-2"><i class="fa fa-check"></i><b>12.2.6</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#conclusion-7"><i class="fa fa-check"></i><b>12.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>13</b> Bayesian AR, ARMA, and ARIMA Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="13.1" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-ar1-model"><i class="fa fa-check"></i><b>13.1</b> Bayesian AR(1) Model</a></li>
<li class="chapter" data-level="13.2" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arma11-model"><i class="fa fa-check"></i><b>13.2</b> Bayesian ARMA(1,1) Model</a></li>
<li class="chapter" data-level="13.3" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arima111-model"><i class="fa fa-check"></i><b>13.3</b> Bayesian ARIMA(1,1,1) Model</a></li>
<li class="chapter" data-level="13.4" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#conclusion-8"><i class="fa fa-check"></i><b>13.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html"><i class="fa fa-check"></i><b>14</b> 14 Bayesian Structural Time Series Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#introduction-6"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#stan-implementation-basic-bsts-model"><i class="fa fa-check"></i><b>14.1.1</b> Stan Implementation: Basic BSTS Model</a></li>
<li class="chapter" data-level="14.1.2" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#stan-implementation-time-varying-trend-volatility"><i class="fa fa-check"></i><b>14.1.2</b> Stan Implementation: Time-Varying Trend Volatility</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#model-comparison-and-selection"><i class="fa fa-check"></i><b>14.2</b> Model Comparison and Selection</a></li>
<li class="chapter" data-level="14.3" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#conclusion-9"><i class="fa fa-check"></i><b>14.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html"><i class="fa fa-check"></i><b>15</b> Model Comparison and Selection in Bayesian Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#introduction-7"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>15.2</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="15.3" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#information-criteria-waic-and-loo-cv"><i class="fa fa-check"></i><b>15.3</b> Information Criteria: WAIC and LOO-CV</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#waic-watanabe-akaike-information-criterion"><i class="fa fa-check"></i><b>15.3.1</b> WAIC (Watanabe-Akaike Information Criterion)</a></li>
<li class="chapter" data-level="15.3.2" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#loo-cv-leave-one-out-cross-validation"><i class="fa fa-check"></i><b>15.3.2</b> LOO-CV (Leave-One-Out Cross-Validation)</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#bayes-factors-vs.-information-criteria"><i class="fa fa-check"></i><b>15.4</b> Bayes Factors vs. Information Criteria</a></li>
<li class="chapter" data-level="15.5" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#summary-of-bayesian-model-comparison-methods"><i class="fa fa-check"></i><b>15.5</b> Summary of Bayesian Model Comparison Methods</a></li>
<li class="chapter" data-level="15.6" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#practical-example-comparing-models-in-r"><i class="fa fa-check"></i><b>15.6</b> Practical Example: Comparing Models in R</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>16</b> Appendix</a>
<ul>
<li class="chapter" data-level="16.1" data-path="appendix.html"><a href="appendix.html#main-stan-distributions-cheatsheet"><i class="fa fa-check"></i><b>16.1</b> Main Stan Distributions Cheatsheet</a></li>
<li class="chapter" data-level="16.2" data-path="appendix.html"><a href="appendix.html#main-stan-functions-cheatsheet"><i class="fa fa-check"></i><b>16.2</b> Main Stan Functions Cheatsheet</a></li>
<li class="chapter" data-level="16.3" data-path="appendix.html"><a href="appendix.html#why-non-distribution-functions"><i class="fa fa-check"></i><b>16.3</b> Why Non-Distribution Functions?</a></li>
<li class="chapter" data-level="16.4" data-path="appendix.html"><a href="appendix.html#stan-functions-cheatsheet"><i class="fa fa-check"></i><b>16.4</b> Stan Functions Cheatsheet</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="appendix.html"><a href="appendix.html#mathematical-functions"><i class="fa fa-check"></i><b>16.4.1</b> 1. Mathematical Functions</a></li>
<li class="chapter" data-level="16.4.2" data-path="appendix.html"><a href="appendix.html#transformation-functions"><i class="fa fa-check"></i><b>16.4.2</b> 2. Transformation Functions</a></li>
<li class="chapter" data-level="16.4.3" data-path="appendix.html"><a href="appendix.html#matrix-and-vector-operations"><i class="fa fa-check"></i><b>16.4.3</b> 3. Matrix and Vector Operations</a></li>
<li class="chapter" data-level="16.4.4" data-path="appendix.html"><a href="appendix.html#utility-functions"><i class="fa fa-check"></i><b>16.4.4</b> 4. Utility Functions</a></li>
<li class="chapter" data-level="16.4.5" data-path="appendix.html"><a href="appendix.html#specialized-solvers"><i class="fa fa-check"></i><b>16.4.5</b> 5. Specialized Solvers</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="appendix.html"><a href="appendix.html#example-hierarchical-linear-regression"><i class="fa fa-check"></i><b>16.5</b> Example: Hierarchical Linear Regression</a></li>
<li class="chapter" data-level="16.6" data-path="appendix.html"><a href="appendix.html#tips-for-using-stan-functions"><i class="fa fa-check"></i><b>16.6</b> Tips for Using Stan Functions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-quantile-regression" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Bayesian Quantile Regression<a href="bayesian-quantile-regression.html#bayesian-quantile-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-2" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction<a href="bayesian-quantile-regression.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Quantile regression extends traditional regression analysis beyond the conditional mean to model the entire conditional distribution of the response variable. For a response variable <span class="math inline">\(Y\)</span> and predictor variables <span class="math inline">\(\mathbf{X}\)</span>, the <span class="math inline">\(\tau\)</span>-th quantile function is defined as <span class="math inline">\(Q_\tau(Y|\mathbf{X}) = \inf\{y : F_{Y|\mathbf{X}}(y) \geq \tau\}\)</span>, where <span class="math inline">\(F_{Y|\mathbf{X}}(y)\)</span> represents the conditional cumulative distribution function and <span class="math inline">\(\tau \in (0,1)\)</span> denotes the quantile level. This formulation allows researchers to examine how predictor variables influence different portions of the response distribution, providing insights that may be obscured when focusing solely on conditional means.</p>
<p>The mathematical foundation of quantile regression rests on the asymmetric Laplace distribution (ALD), which serves as the working likelihood. For the <span class="math inline">\(\tau\)</span>-th quantile, the ALD has the probability density function:</p>
<p><span class="math display">\[f(y|\mu, \sigma, \tau) = \frac{\tau(1-\tau)}{\sigma} \exp\left(-\rho_\tau\left(\frac{y-\mu}{\sigma}\right)\right)\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> represents the location parameter (the <span class="math inline">\(\tau\)</span>-th quantile), <span class="math inline">\(\sigma &gt; 0\)</span> is the scale parameter, and <span class="math inline">\(\rho_\tau(u) = u(\tau - I(u &lt; 0))\)</span> is the check function with <span class="math inline">\(I(\cdot)\)</span> being the indicator function. This check function is fundamental to quantile regression as it provides the loss function that is minimized during estimation: <span class="math inline">\(\sum_{i=1}^n \rho_\tau(y_i - \mathbf{x}_i^T\boldsymbol{\beta})\)</span>.</p>
<p>The Bayesian framework transforms quantile regression into a hierarchical model where uncertainty is explicitly modeled through prior distributions. Consider the linear quantile regression model <span class="math inline">\(Q_\tau(Y_i|\mathbf{x}_i) = \mathbf{x}_i^T\boldsymbol{\beta}_\tau\)</span>, where <span class="math inline">\(\boldsymbol{\beta}_\tau\)</span> represents the vector of regression coefficients specific to the <span class="math inline">\(\tau\)</span>-th quantile. In the Bayesian setting, we specify prior distributions for these parameters, typically <span class="math inline">\(\boldsymbol{\beta}_\tau \sim \mathcal{N}(\boldsymbol{\mu}_0, \boldsymbol{\Sigma}_0)\)</span> for the regression coefficients and <span class="math inline">\(\sigma \sim \text{Inv-Gamma}(a, b)\)</span> for the scale parameter. The posterior distribution is then proportional to the product of the likelihood and priors: <span class="math inline">\(p(\boldsymbol{\beta}_\tau, \sigma | \mathbf{y}, \mathbf{X}) \propto \prod_{i=1}^n f(y_i|\mathbf{x}_i^T\boldsymbol{\beta}_\tau, \sigma, \tau) \cdot p(\boldsymbol{\beta}_\tau) \cdot p(\sigma)\)</span>.</p>
<p>Stan implements this Bayesian quantile regression through efficient Hamiltonian Monte Carlo (HMC) sampling, which provides several computational advantages over traditional optimization-based methods. The HMC algorithm exploits the geometry of the posterior distribution by using gradient information to propose new states in the Markov chain, resulting in more efficient exploration of the parameter space. This is particularly beneficial for quantile regression models, which often exhibit multimodal or skewed posterior distributions due to the asymmetric nature of the loss function. The resulting MCMC samples provide a complete characterization of parameter uncertainty, enabling probabilistic statements about quantile estimates and facilitating hypothesis testing through posterior probability calculations.</p>
<p>The incorporation of prior information represents a significant advantage of the Bayesian approach, particularly in healthcare applications where domain expertise can inform model specification. Informative priors can be constructed based on previous studies, clinical knowledge, or expert opinion. For instance, if prior research suggests that a treatment effect is positive but with considerable uncertainty, this can be encoded through a normal prior centered at a positive value with appropriate variance. Mathematically, this might be expressed as <span class="math inline">\(\beta_{\text{treatment}} \sim \mathcal{N}(0.5, 1.0^2)\)</span>, indicating a belief that the treatment effect is likely positive but allowing for substantial uncertainty. Such priors serve as regularization mechanisms, particularly valuable when dealing with limited data or complex models prone to overfitting.</p>
<p>The Bayesian framework naturally provides uncertainty quantification through the posterior distribution, which contrasts sharply with frequentist approaches that rely on asymptotic approximations. For any function of the parameters <span class="math inline">\(g(\boldsymbol{\theta})\)</span>, credible intervals can be constructed directly from the posterior samples without relying on distributional assumptions. This is particularly valuable for quantile regression, where the sampling distribution of quantile estimates can be complex and non-normal. The posterior predictive distribution <span class="math inline">\(p(\tilde{y}|\mathbf{x}, \mathbf{y}, \mathbf{X})\)</span> provides a complete description of uncertainty in future observations, enabling probabilistic forecasting and risk assessment.</p>
<p>Model comparison and selection within the Bayesian quantile regression framework can be performed using information-theoretic criteria such as the Widely Applicable Information Criterion (WAIC) or Leave-One-Out Cross-Validation (LOO-CV). These criteria balance model fit against complexity, providing guidance for variable selection and model specification. For nested models, Bayes factors can be computed to quantify the evidence in favor of one model over another: <span class="math inline">\(BF_{12} = \frac{p(\mathbf{y}|M_1)}{p(\mathbf{y}|M_2)}\)</span>, where <span class="math inline">\(p(\mathbf{y}|M_i)\)</span> represents the marginal likelihood under model <span class="math inline">\(M_i\)</span>. Additionally, posterior predictive checking enables model validation by comparing observed data patterns with those generated from the fitted model.</p>
<p>Healthcare applications particularly benefit from Bayesian quantile regression due to the heterogeneous nature of clinical data and the importance of understanding distributional effects rather than just average treatment effects. Consider a clinical trial where the primary outcome exhibits heteroscedasticity across patient subgroups. Traditional mean regression might indicate no overall treatment effect, while quantile regression could reveal significant benefits for patients in the upper quantiles of the outcome distribution, corresponding perhaps to those with more severe disease. The Bayesian approach allows for the incorporation of prior knowledge about biological mechanisms, previous trial results, and regulatory requirements, while providing uncertainty estimates that are crucial for clinical decision-making.</p>
<p>The computational implementation in Stan leverages automatic differentiation to compute gradients of the log-posterior density, enabling efficient HMC sampling even for complex models with hundreds of parameters. Stan’s modeling language allows for flexible specification of hierarchical structures, time-varying coefficients, and non-linear relationships, making it particularly suitable for the complex models often encountered in healthcare research. The software automatically handles the transformation of constrained parameters, monitors convergence diagnostics, and provides comprehensive posterior summaries, making advanced Bayesian quantile regression accessible to applied researchers.</p>
<p>To illustrate the practical implementation of Bayesian quantile regression with Stan, we now examine a synthetic heteroskedastic dataset that demonstrates the method’s ability to capture distributional heterogeneity across the predictor space. This example will showcase how the Bayesian framework handles uncertainty quantification while revealing patterns that would be missed by traditional mean-based regression approaches.</p>
</div>
<div id="model-specification" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Model Specification<a href="bayesian-quantile-regression.html#model-specification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="using-bayesqr-package" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Using bayesQR package<a href="bayesian-quantile-regression.html#using-bayesqr-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulate data from heteroskedastic regression</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="bayesian-quantile-regression.html#cb97-1" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">66</span>)</span>
<span id="cb97-2"><a href="bayesian-quantile-regression.html#cb97-2" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb97-3"><a href="bayesian-quantile-regression.html#cb97-3" tabindex="-1"></a><span class="fu">library</span>(bayesQR)</span>
<span id="cb97-4"><a href="bayesian-quantile-regression.html#cb97-4" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb97-5"><a href="bayesian-quantile-regression.html#cb97-5" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span>n,<span class="at">min=</span><span class="dv">0</span>,<span class="at">max=</span><span class="dv">10</span>)</span>
<span id="cb97-6"><a href="bayesian-quantile-regression.html#cb97-6" tabindex="-1"></a>    X <span class="ot">&lt;-</span> X</span>
<span id="cb97-7"><a href="bayesian-quantile-regression.html#cb97-7" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n=</span>n, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>.<span class="dv">6</span><span class="sc">*</span>X)</span></code></pre></div>
<p>Estimate series of quantile regressions with adaptive lasso
to limit execution time of the example, ndraw is set to a very low value. Set value to 5000 for a better approximation of the posterior distirubtion.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="bayesian-quantile-regression.html#cb98-1" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb98-2"><a href="bayesian-quantile-regression.html#cb98-2" tabindex="-1"></a><span class="fu">library</span>(bayesQR)</span>
<span id="cb98-3"><a href="bayesian-quantile-regression.html#cb98-3" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">bayesQR</span>(y<span class="sc">~</span>X, <span class="at">quantile=</span><span class="fu">c</span>(.<span class="dv">05</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,.<span class="dv">95</span>), <span class="at">alasso=</span><span class="cn">TRUE</span>, <span class="at">ndraw=</span><span class="dv">500</span>)</span></code></pre></div>
<pre><code>## ************************************************ 
## * Start estimating quantile  1  of  5 in total * 
## ************************************************ 
## Current iteration :
## [1] 500
## ************************************************ 
## * Start estimating quantile  2  of  5 in total * 
## ************************************************ 
## Current iteration :
## [1] 500
## ************************************************ 
## * Start estimating quantile  3  of  5 in total * 
## ************************************************ 
## Current iteration :
## [1] 500
## ************************************************ 
## * Start estimating quantile  4  of  5 in total * 
## ************************************************ 
## Current iteration :
## [1] 500
## ************************************************ 
## * Start estimating quantile  5  of  5 in total * 
## ************************************************ 
## Current iteration :
## [1] 500</code></pre>
<p>Initiate plot</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="bayesian-quantile-regression.html#cb100-1" tabindex="-1"></a>    <span class="fu">plot</span>(X, y, <span class="at">main=</span><span class="st">&quot;&quot;</span>, <span class="at">cex=</span>.<span class="dv">6</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>)</span>
<span id="cb100-2"><a href="bayesian-quantile-regression.html#cb100-2" tabindex="-1"></a>    <span class="do">## Add quantile regression lines to the plot (exclude first 500 burn-in draws)</span></span>
<span id="cb100-3"><a href="bayesian-quantile-regression.html#cb100-3" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(out, <span class="at">burnin=</span><span class="dv">50</span>)</span>
<span id="cb100-4"><a href="bayesian-quantile-regression.html#cb100-4" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sum)){</span>
<span id="cb100-5"><a href="bayesian-quantile-regression.html#cb100-5" tabindex="-1"></a>      <span class="fu">abline</span>(<span class="at">a=</span>sum[[i]]<span class="sc">$</span>betadraw[<span class="dv">1</span>,<span class="dv">1</span>],<span class="at">b=</span>sum[[i]]<span class="sc">$</span>betadraw[<span class="dv">2</span>,<span class="dv">1</span>],<span class="at">lty=</span>i,<span class="at">col=</span>i)</span>
<span id="cb100-6"><a href="bayesian-quantile-regression.html#cb100-6" tabindex="-1"></a>    }</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="bayesian-quantile-regression.html#cb101-1" tabindex="-1"></a>outOLS <span class="ot">=</span> <span class="fu">lm</span>(y<span class="sc">~</span>X)</span>
<span id="cb101-2"><a href="bayesian-quantile-regression.html#cb101-2" tabindex="-1"></a><span class="fu">plot</span>(X, y, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb101-3"><a href="bayesian-quantile-regression.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="bayesian-quantile-regression.html#cb101-4" tabindex="-1"></a>    <span class="fu">abline</span>(outOLS,<span class="at">lty=</span><span class="dv">1</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">6</span>)</span>
<span id="cb101-5"><a href="bayesian-quantile-regression.html#cb101-5" tabindex="-1"></a>    <span class="co"># Add legend to plot</span></span>
<span id="cb101-6"><a href="bayesian-quantile-regression.html#cb101-6" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span><span class="fu">max</span>(y),<span class="at">legend=</span><span class="fu">c</span>(.<span class="dv">05</span>,.<span class="dv">25</span>,.<span class="dv">50</span>,.<span class="dv">75</span>,.<span class="dv">95</span>,<span class="st">&quot;OLS&quot;</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb101-7"><a href="bayesian-quantile-regression.html#cb101-7" tabindex="-1"></a>           <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),<span class="at">title=</span><span class="st">&quot;Quantile&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="using-brms-package" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Using brms package<a href="bayesian-quantile-regression.html#using-brms-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="bayesian-quantile-regression.html#cb102-1" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb102-2"><a href="bayesian-quantile-regression.html#cb102-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n =</span> n, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">10</span>)</span>
<span id="cb102-3"><a href="bayesian-quantile-regression.html#cb102-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.6</span><span class="sc">*</span>x)</span>
<span id="cb102-4"><a href="bayesian-quantile-regression.html#cb102-4" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb102-5"><a href="bayesian-quantile-regression.html#cb102-5" tabindex="-1"></a><span class="co"># fit the 20%-quantile</span></span>
<span id="cb102-6"><a href="bayesian-quantile-regression.html#cb102-6" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="fu">bf</span>(y <span class="sc">~</span> x, <span class="at">quantile =</span> <span class="fl">0.2</span>), <span class="at">data =</span> dat, <span class="at">family =</span> <span class="fu">asym_laplace</span>())</span></code></pre></div>
<pre><code>## Compiling Stan program...</code></pre>
<pre><code>## Start sampling</code></pre>
<pre><code>## 
## SAMPLING FOR MODEL &#39;anon_model&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 0.000108 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.08 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.237 seconds (Warm-up)
## Chain 1:                0.223 seconds (Sampling)
## Chain 1:                0.46 seconds (Total)
## Chain 1: 
## 
## SAMPLING FOR MODEL &#39;anon_model&#39; NOW (CHAIN 2).
## Chain 2: 
## Chain 2: Gradient evaluation took 3.3e-05 seconds
## Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.33 seconds.
## Chain 2: Adjust your expectations accordingly!
## Chain 2: 
## Chain 2: 
## Chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 2: 
## Chain 2:  Elapsed Time: 0.247 seconds (Warm-up)
## Chain 2:                0.28 seconds (Sampling)
## Chain 2:                0.527 seconds (Total)
## Chain 2: 
## 
## SAMPLING FOR MODEL &#39;anon_model&#39; NOW (CHAIN 3).
## Chain 3: 
## Chain 3: Gradient evaluation took 3.2e-05 seconds
## Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.32 seconds.
## Chain 3: Adjust your expectations accordingly!
## Chain 3: 
## Chain 3: 
## Chain 3: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 3: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 3: 
## Chain 3:  Elapsed Time: 0.232 seconds (Warm-up)
## Chain 3:                0.23 seconds (Sampling)
## Chain 3:                0.462 seconds (Total)
## Chain 3: 
## 
## SAMPLING FOR MODEL &#39;anon_model&#39; NOW (CHAIN 4).
## Chain 4: 
## Chain 4: Gradient evaluation took 3.3e-05 seconds
## Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.33 seconds.
## Chain 4: Adjust your expectations accordingly!
## Chain 4: 
## Chain 4: 
## Chain 4: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 4: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 4: 
## Chain 4:  Elapsed Time: 0.228 seconds (Warm-up)
## Chain 4:                0.219 seconds (Sampling)
## Chain 4:                0.447 seconds (Total)
## Chain 4:</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="bayesian-quantile-regression.html#cb106-1" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code></pre></div>
<pre><code>##  Family: asym_laplace 
##   Links: mu = identity; sigma = identity; quantile = identity 
## Formula: y ~ x 
##          quantile = 0.2
##    Data: dat (Number of observations: 200) 
##   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup draws = 4000
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     1.08      0.20     0.66     1.46 1.00     3146     2472
## x             1.43      0.05     1.33     1.54 1.00     2156     1963
## 
## Further Distributional Parameters:
##          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma        0.84      0.06     0.73     0.96 1.00     2340     2532
## quantile     0.20      0.00     0.20     0.20   NA       NA       NA
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="backend-stan-model" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Backend stan model<a href="bayesian-quantile-regression.html#backend-stan-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb108-1"><a href="bayesian-quantile-regression.html#cb108-1" tabindex="-1"></a><span class="kw">functions</span> {</span>
<span id="cb108-2"><a href="bayesian-quantile-regression.html#cb108-2" tabindex="-1"></a>  <span class="co">/* helper function for asym_laplace_lpdf</span></span>
<span id="cb108-3"><a href="bayesian-quantile-regression.html#cb108-3" tabindex="-1"></a><span class="co">   * Args:</span></span>
<span id="cb108-4"><a href="bayesian-quantile-regression.html#cb108-4" tabindex="-1"></a><span class="co">   *   y: the response value</span></span>
<span id="cb108-5"><a href="bayesian-quantile-regression.html#cb108-5" tabindex="-1"></a><span class="co">   *   quantile: quantile parameter in (0, 1)</span></span>
<span id="cb108-6"><a href="bayesian-quantile-regression.html#cb108-6" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb108-7"><a href="bayesian-quantile-regression.html#cb108-7" tabindex="-1"></a>   <span class="dt">real</span> rho_quantile(<span class="dt">real</span> y, <span class="dt">real</span> quantile) {</span>
<span id="cb108-8"><a href="bayesian-quantile-regression.html#cb108-8" tabindex="-1"></a>     <span class="cf">if</span> (y &lt; <span class="dv">0</span>) {</span>
<span id="cb108-9"><a href="bayesian-quantile-regression.html#cb108-9" tabindex="-1"></a>       <span class="cf">return</span> y * (quantile - <span class="dv">1</span>);</span>
<span id="cb108-10"><a href="bayesian-quantile-regression.html#cb108-10" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb108-11"><a href="bayesian-quantile-regression.html#cb108-11" tabindex="-1"></a>       <span class="cf">return</span> y * quantile;</span>
<span id="cb108-12"><a href="bayesian-quantile-regression.html#cb108-12" tabindex="-1"></a>     }</span>
<span id="cb108-13"><a href="bayesian-quantile-regression.html#cb108-13" tabindex="-1"></a>   }</span>
<span id="cb108-14"><a href="bayesian-quantile-regression.html#cb108-14" tabindex="-1"></a>  <span class="co">/* asymmetric laplace log-PDF for a single response</span></span>
<span id="cb108-15"><a href="bayesian-quantile-regression.html#cb108-15" tabindex="-1"></a><span class="co">   * Args:</span></span>
<span id="cb108-16"><a href="bayesian-quantile-regression.html#cb108-16" tabindex="-1"></a><span class="co">   *   y: the response value</span></span>
<span id="cb108-17"><a href="bayesian-quantile-regression.html#cb108-17" tabindex="-1"></a><span class="co">   *   mu: location parameter</span></span>
<span id="cb108-18"><a href="bayesian-quantile-regression.html#cb108-18" tabindex="-1"></a><span class="co">   *   sigma: positive scale parameter</span></span>
<span id="cb108-19"><a href="bayesian-quantile-regression.html#cb108-19" tabindex="-1"></a><span class="co">   *   quantile: quantile parameter in (0, 1)</span></span>
<span id="cb108-20"><a href="bayesian-quantile-regression.html#cb108-20" tabindex="-1"></a><span class="co">   * Returns:</span></span>
<span id="cb108-21"><a href="bayesian-quantile-regression.html#cb108-21" tabindex="-1"></a><span class="co">   *   a scalar to be added to the log posterior</span></span>
<span id="cb108-22"><a href="bayesian-quantile-regression.html#cb108-22" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb108-23"><a href="bayesian-quantile-regression.html#cb108-23" tabindex="-1"></a>   <span class="dt">real</span> asym_laplace_lpdf(<span class="dt">real</span> y, <span class="dt">real</span> mu, <span class="dt">real</span> sigma, <span class="dt">real</span> quantile) {</span>
<span id="cb108-24"><a href="bayesian-quantile-regression.html#cb108-24" tabindex="-1"></a>     <span class="cf">return</span> log(quantile * (<span class="dv">1</span> - quantile)) -</span>
<span id="cb108-25"><a href="bayesian-quantile-regression.html#cb108-25" tabindex="-1"></a>            log(sigma) -</span>
<span id="cb108-26"><a href="bayesian-quantile-regression.html#cb108-26" tabindex="-1"></a>            rho_quantile((y - mu) / sigma, quantile);</span>
<span id="cb108-27"><a href="bayesian-quantile-regression.html#cb108-27" tabindex="-1"></a>   }</span>
<span id="cb108-28"><a href="bayesian-quantile-regression.html#cb108-28" tabindex="-1"></a>  <span class="co">/* asymmetric laplace log-CDF for a single quantile</span></span>
<span id="cb108-29"><a href="bayesian-quantile-regression.html#cb108-29" tabindex="-1"></a><span class="co">   * Args:</span></span>
<span id="cb108-30"><a href="bayesian-quantile-regression.html#cb108-30" tabindex="-1"></a><span class="co">   *   y: a quantile</span></span>
<span id="cb108-31"><a href="bayesian-quantile-regression.html#cb108-31" tabindex="-1"></a><span class="co">   *   mu: location parameter</span></span>
<span id="cb108-32"><a href="bayesian-quantile-regression.html#cb108-32" tabindex="-1"></a><span class="co">   *   sigma: positive scale parameter</span></span>
<span id="cb108-33"><a href="bayesian-quantile-regression.html#cb108-33" tabindex="-1"></a><span class="co">   *   quantile: quantile parameter in (0, 1)</span></span>
<span id="cb108-34"><a href="bayesian-quantile-regression.html#cb108-34" tabindex="-1"></a><span class="co">   * Returns:</span></span>
<span id="cb108-35"><a href="bayesian-quantile-regression.html#cb108-35" tabindex="-1"></a><span class="co">   *   a scalar to be added to the log posterior</span></span>
<span id="cb108-36"><a href="bayesian-quantile-regression.html#cb108-36" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb108-37"><a href="bayesian-quantile-regression.html#cb108-37" tabindex="-1"></a>   <span class="dt">real</span> asym_laplace_lcdf(<span class="dt">real</span> y, <span class="dt">real</span> mu, <span class="dt">real</span> sigma, <span class="dt">real</span> quantile) {</span>
<span id="cb108-38"><a href="bayesian-quantile-regression.html#cb108-38" tabindex="-1"></a>     <span class="cf">if</span> (y &lt; mu) {</span>
<span id="cb108-39"><a href="bayesian-quantile-regression.html#cb108-39" tabindex="-1"></a>       <span class="cf">return</span> log(quantile) + (<span class="dv">1</span> - quantile) * (y - mu) / sigma;</span>
<span id="cb108-40"><a href="bayesian-quantile-regression.html#cb108-40" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb108-41"><a href="bayesian-quantile-regression.html#cb108-41" tabindex="-1"></a>       <span class="cf">return</span> log1m((<span class="dv">1</span> - quantile) * exp(-quantile * (y - mu) / sigma));</span>
<span id="cb108-42"><a href="bayesian-quantile-regression.html#cb108-42" tabindex="-1"></a>     }</span>
<span id="cb108-43"><a href="bayesian-quantile-regression.html#cb108-43" tabindex="-1"></a>   }</span>
<span id="cb108-44"><a href="bayesian-quantile-regression.html#cb108-44" tabindex="-1"></a>  <span class="co">/* asymmetric laplace log-CCDF for a single quantile</span></span>
<span id="cb108-45"><a href="bayesian-quantile-regression.html#cb108-45" tabindex="-1"></a><span class="co">   * Args:</span></span>
<span id="cb108-46"><a href="bayesian-quantile-regression.html#cb108-46" tabindex="-1"></a><span class="co">   *   y: a quantile</span></span>
<span id="cb108-47"><a href="bayesian-quantile-regression.html#cb108-47" tabindex="-1"></a><span class="co">   *   mu: location parameter</span></span>
<span id="cb108-48"><a href="bayesian-quantile-regression.html#cb108-48" tabindex="-1"></a><span class="co">   *   sigma: positive scale parameter</span></span>
<span id="cb108-49"><a href="bayesian-quantile-regression.html#cb108-49" tabindex="-1"></a><span class="co">   *   quantile: quantile parameter in (0, 1)</span></span>
<span id="cb108-50"><a href="bayesian-quantile-regression.html#cb108-50" tabindex="-1"></a><span class="co">   * Returns:</span></span>
<span id="cb108-51"><a href="bayesian-quantile-regression.html#cb108-51" tabindex="-1"></a><span class="co">   *   a scalar to be added to the log posterior</span></span>
<span id="cb108-52"><a href="bayesian-quantile-regression.html#cb108-52" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb108-53"><a href="bayesian-quantile-regression.html#cb108-53" tabindex="-1"></a>   <span class="dt">real</span> asym_laplace_lccdf(<span class="dt">real</span> y, <span class="dt">real</span> mu, <span class="dt">real</span> sigma, <span class="dt">real</span> quantile) {</span>
<span id="cb108-54"><a href="bayesian-quantile-regression.html#cb108-54" tabindex="-1"></a>     <span class="cf">if</span> (y &lt; mu) {</span>
<span id="cb108-55"><a href="bayesian-quantile-regression.html#cb108-55" tabindex="-1"></a>       <span class="cf">return</span> log1m(quantile * exp((<span class="dv">1</span> - quantile) * (y - mu) / sigma));</span>
<span id="cb108-56"><a href="bayesian-quantile-regression.html#cb108-56" tabindex="-1"></a>     } <span class="cf">else</span> {</span>
<span id="cb108-57"><a href="bayesian-quantile-regression.html#cb108-57" tabindex="-1"></a>       <span class="cf">return</span> log1m(quantile) - quantile * (y - mu) / sigma;</span>
<span id="cb108-58"><a href="bayesian-quantile-regression.html#cb108-58" tabindex="-1"></a>     }</span>
<span id="cb108-59"><a href="bayesian-quantile-regression.html#cb108-59" tabindex="-1"></a>   }</span>
<span id="cb108-60"><a href="bayesian-quantile-regression.html#cb108-60" tabindex="-1"></a>}</span>
<span id="cb108-61"><a href="bayesian-quantile-regression.html#cb108-61" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb108-62"><a href="bayesian-quantile-regression.html#cb108-62" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N;  <span class="co">// total number of observations</span></span>
<span id="cb108-63"><a href="bayesian-quantile-regression.html#cb108-63" tabindex="-1"></a>  <span class="dt">vector</span>[N] Y;  <span class="co">// response variable</span></span>
<span id="cb108-64"><a href="bayesian-quantile-regression.html#cb108-64" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; K;  <span class="co">// number of population-level effects</span></span>
<span id="cb108-65"><a href="bayesian-quantile-regression.html#cb108-65" tabindex="-1"></a>  <span class="dt">matrix</span>[N, K] X;  <span class="co">// population-level design matrix</span></span>
<span id="cb108-66"><a href="bayesian-quantile-regression.html#cb108-66" tabindex="-1"></a>  <span class="dt">int</span> prior_only;  <span class="co">// should the likelihood be ignored?</span></span>
<span id="cb108-67"><a href="bayesian-quantile-regression.html#cb108-67" tabindex="-1"></a>}</span>
<span id="cb108-68"><a href="bayesian-quantile-regression.html#cb108-68" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb108-69"><a href="bayesian-quantile-regression.html#cb108-69" tabindex="-1"></a>  <span class="dt">int</span> Kc = K - <span class="dv">1</span>;</span>
<span id="cb108-70"><a href="bayesian-quantile-regression.html#cb108-70" tabindex="-1"></a>  <span class="dt">matrix</span>[N, Kc] Xc;  <span class="co">// centered version of X without an intercept</span></span>
<span id="cb108-71"><a href="bayesian-quantile-regression.html#cb108-71" tabindex="-1"></a>  <span class="dt">vector</span>[Kc] means_X;  <span class="co">// column means of X before centering</span></span>
<span id="cb108-72"><a href="bayesian-quantile-regression.html#cb108-72" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span>:K) {</span>
<span id="cb108-73"><a href="bayesian-quantile-regression.html#cb108-73" tabindex="-1"></a>    means_X[i - <span class="dv">1</span>] = mean(X[, i]);</span>
<span id="cb108-74"><a href="bayesian-quantile-regression.html#cb108-74" tabindex="-1"></a>    Xc[, i - <span class="dv">1</span>] = X[, i] - means_X[i - <span class="dv">1</span>];</span>
<span id="cb108-75"><a href="bayesian-quantile-regression.html#cb108-75" tabindex="-1"></a>  }</span>
<span id="cb108-76"><a href="bayesian-quantile-regression.html#cb108-76" tabindex="-1"></a>}</span>
<span id="cb108-77"><a href="bayesian-quantile-regression.html#cb108-77" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb108-78"><a href="bayesian-quantile-regression.html#cb108-78" tabindex="-1"></a>  <span class="dt">vector</span>[Kc] b;  <span class="co">// population-level effects</span></span>
<span id="cb108-79"><a href="bayesian-quantile-regression.html#cb108-79" tabindex="-1"></a>  <span class="dt">real</span> Intercept;  <span class="co">// temporary intercept for centered predictors</span></span>
<span id="cb108-80"><a href="bayesian-quantile-regression.html#cb108-80" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;  <span class="co">// dispersion parameter</span></span>
<span id="cb108-81"><a href="bayesian-quantile-regression.html#cb108-81" tabindex="-1"></a>}</span>
<span id="cb108-82"><a href="bayesian-quantile-regression.html#cb108-82" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb108-83"><a href="bayesian-quantile-regression.html#cb108-83" tabindex="-1"></a>  <span class="dt">real</span> quantile = <span class="fl">0.2</span>;  <span class="co">// quantile parameter</span></span>
<span id="cb108-84"><a href="bayesian-quantile-regression.html#cb108-84" tabindex="-1"></a>  <span class="dt">real</span> lprior = <span class="dv">0</span>;  <span class="co">// prior contributions to the log posterior</span></span>
<span id="cb108-85"><a href="bayesian-quantile-regression.html#cb108-85" tabindex="-1"></a>  lprior += student_t_lpdf(Intercept | <span class="dv">3</span>, <span class="dv">11</span>, <span class="fl">7.8</span>);</span>
<span id="cb108-86"><a href="bayesian-quantile-regression.html#cb108-86" tabindex="-1"></a>  lprior += student_t_lpdf(sigma | <span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">7.8</span>)</span>
<span id="cb108-87"><a href="bayesian-quantile-regression.html#cb108-87" tabindex="-1"></a>    - <span class="dv">1</span> * student_t_lccdf(<span class="dv">0</span> | <span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">7.8</span>);</span>
<span id="cb108-88"><a href="bayesian-quantile-regression.html#cb108-88" tabindex="-1"></a>}</span>
<span id="cb108-89"><a href="bayesian-quantile-regression.html#cb108-89" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb108-90"><a href="bayesian-quantile-regression.html#cb108-90" tabindex="-1"></a>  <span class="co">// likelihood including constants</span></span>
<span id="cb108-91"><a href="bayesian-quantile-regression.html#cb108-91" tabindex="-1"></a>  <span class="cf">if</span> (!prior_only) {</span>
<span id="cb108-92"><a href="bayesian-quantile-regression.html#cb108-92" tabindex="-1"></a>    <span class="co">// initialize linear predictor term</span></span>
<span id="cb108-93"><a href="bayesian-quantile-regression.html#cb108-93" tabindex="-1"></a>    <span class="dt">vector</span>[N] mu = rep_vector(<span class="fl">0.0</span>, N);</span>
<span id="cb108-94"><a href="bayesian-quantile-regression.html#cb108-94" tabindex="-1"></a>    mu += Intercept + Xc * b;</span>
<span id="cb108-95"><a href="bayesian-quantile-regression.html#cb108-95" tabindex="-1"></a>    <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb108-96"><a href="bayesian-quantile-regression.html#cb108-96" tabindex="-1"></a>      <span class="kw">target +=</span> asym_laplace_lpdf(Y[n] | mu[n], sigma, quantile);</span>
<span id="cb108-97"><a href="bayesian-quantile-regression.html#cb108-97" tabindex="-1"></a>    }</span>
<span id="cb108-98"><a href="bayesian-quantile-regression.html#cb108-98" tabindex="-1"></a>  }</span>
<span id="cb108-99"><a href="bayesian-quantile-regression.html#cb108-99" tabindex="-1"></a>  <span class="co">// priors including constants</span></span>
<span id="cb108-100"><a href="bayesian-quantile-regression.html#cb108-100" tabindex="-1"></a>  <span class="kw">target +=</span> lprior;</span>
<span id="cb108-101"><a href="bayesian-quantile-regression.html#cb108-101" tabindex="-1"></a>}</span>
<span id="cb108-102"><a href="bayesian-quantile-regression.html#cb108-102" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb108-103"><a href="bayesian-quantile-regression.html#cb108-103" tabindex="-1"></a>  <span class="co">// actual population-level intercept</span></span>
<span id="cb108-104"><a href="bayesian-quantile-regression.html#cb108-104" tabindex="-1"></a>  <span class="dt">real</span> b_Intercept = Intercept - dot_product(means_X, b);</span>
<span id="cb108-105"><a href="bayesian-quantile-regression.html#cb108-105" tabindex="-1"></a>}</span></code></pre></div>
<p>This Stan code specifies a Bayesian model for asymmetric Laplace regression, where the main goal is to estimate the population-level effects and dispersion parameter of the model from the provided data. The asymmetric Laplace distribution is used as the likelihood function for the response variable. The <code>functions</code> block contains three helper functions: <code>rho_quantile</code>, <code>asym_laplace_lpdf</code>, and <code>asym_laplace_lccdf</code>. These functions are used to calculate the asymmetric Laplace log-PDF, log-CDF, and log-CCDF for a single response variable. The <code>data</code> block defines the input data for the model, including the total number of observations <code>N</code>, the response variable <code>Y</code>, the number of population-level effects <code>K</code>, the population-level design matrix <code>X</code>, and a binary variable <code>prior_only</code> that indicates whether to ignore the likelihood (for prior-only sampling). The <code>transformed data</code> block preprocesses the data. It calculates the centered version of the design matrix <code>Xc</code>, removes the intercept from the design matrix <code>X</code>, and stores the column means of <code>X</code> before centering in the vector <code>means_X</code>. The <code>parameters</code> block defines the parameters to be estimated in the model. It includes the population-level effects <code>b</code>, the temporary intercept for centered predictors <code>Intercept</code>, and the dispersion parameter <code>sigma</code>. The <code>transformed parameters</code> block calculates the quantile parameter <code>quantile</code> (set to 0.2 in this case) and the prior contributions to the log posterior (<code>lprior</code>). The <code>lprior</code> term includes the priors for the <code>Intercept</code> and <code>sigma</code> parameters, which are specified as Student’s t-distributions. The <code>model</code> block defines the likelihood and priors for the model. The likelihood accounts for the asymmetric Laplace distribution for the response variable <code>Y</code>, given the linear predictor <code>mu</code> (calculated using the population-level effects <code>b</code> and <code>Intercept</code>) and the dispersion parameter <code>sigma</code>. If <code>prior_only</code> is true, the likelihood is ignored, and the model only considers the priors. The <code>generated quantities</code> block computes the actual population-level intercept <code>b_Intercept</code> by removing the effect of the centered predictors from the temporary intercept <code>Intercept</code>.</p>
</div>
</div>
<div id="conclusion-3" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Conclusion<a href="bayesian-quantile-regression.html#conclusion-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Bayesian quantile regression extends classical regression analysis by allowing researchers to model the entire conditional distribution of outcomes rather than restricting inference to the mean. By leveraging the asymmetric Laplace distribution as a working likelihood and incorporating prior information, this approach offers a principled framework for uncertainty quantification, flexible model specification, and probabilistic forecasting. The use of Hamiltonian Monte Carlo, as implemented in Stan, enables efficient exploration of complex posterior distributions, making Bayesian quantile regression both theoretically rigorous and computationally feasible. The examples with simulated heteroskedastic data highlight its capacity to reveal heterogeneous effects across the outcome distribution that would remain hidden under mean-based methods, underscoring its practical relevance for applied domains such as healthcare research, where distributional differences often carry critical substantive implications.</p>
</div>
<div id="references-4" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> References<a href="bayesian-quantile-regression.html#references-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Yu, K., &amp; Moyeed, R. A. (2001). Bayesian quantile regression. Statistics &amp; Probability Letters, 54(4), 437-447.</li>
<li>Kottas, A., &amp; Gelfand, A. E. (2001). Bayesian semiparametric median regression modeling. Journal of the American Statistical Association, 97(457), 109-121.</li>
<li>Koenker, R., &amp; Xiao, Z. (2006). Quantile autoregression. Journal of the American Statistical Association, 101(475), 980-990.</li>
<li>Yu, K., &amp; Moyeed, R. A. (2000). Bayesian quantile regression. Journal of the Royal Statistical Society: Series D (The Statistician), 49(3), 385-392.</li>
<li>Koenker, R., &amp; Xiao, Z. (2004). Inference on the quantile regression process. Econometrica, 72(1), 71-104.</li>
<li><a href="https://cran.r-project.org/web/packages/bayesQR/bayesQR.pdf" class="uri">https://cran.r-project.org/web/packages/bayesQR/bayesQR.pdf</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-regularized-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-multilevel-regression-in-stan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/edit/main/06-Quentile.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/blob/main/06-Quentile.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
