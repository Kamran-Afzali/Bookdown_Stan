<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Bayesian Multilevel (Mixed Effects) Regression in Stan | Stan Bookdown</title>
  <meta name="description" content="Chapter 7 Bayesian Multilevel (Mixed Effects) Regression in Stan | Stan Bookdown" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Bayesian Multilevel (Mixed Effects) Regression in Stan | Stan Bookdown" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Bayesian Multilevel (Mixed Effects) Regression in Stan | Stan Bookdown" />
  
  
  

<meta name="author" content="Kamran Afzali" />


<meta name="date" content="2025-07-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-quantile-regression.html"/>
<link rel="next" href="gaussian-process-regression-gpr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stan</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Choosing the Right Bayesian Model</a></li>
<li class="chapter" data-level="2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html"><i class="fa fa-check"></i><b>2</b> Bayesian Modeling in R and Stan</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#what-is-stan"><i class="fa fa-check"></i><b>2.1</b> What is STAN?</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#model-file"><i class="fa fa-check"></i><b>2.2</b> Model file</a></li>
<li class="chapter" data-level="2.3" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#fit-the-model"><i class="fa fa-check"></i><b>2.3</b> Fit the model</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#mcmc-diagnostics"><i class="fa fa-check"></i><b>2.4</b> MCMC diagnostics</a></li>
<li class="chapter" data-level="2.5" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#parting-thoughts"><i class="fa fa-check"></i><b>2.5</b> Parting thoughts</a></li>
<li class="chapter" data-level="2.6" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#conclusions"><i class="fa fa-check"></i><b>2.6</b> Conclusions</a></li>
<li class="chapter" data-level="2.7" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#references"><i class="fa fa-check"></i><b>2.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html"><i class="fa fa-check"></i><b>3</b> Bayesian Regression Models for Non-Normal Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#logistic-regression"><i class="fa fa-check"></i><b>3.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#negative-binomial"><i class="fa fa-check"></i><b>3.2</b> Negative Binomial</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
<li class="chapter" data-level="3.4" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#references-1"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="robust-t-regression.html"><a href="robust-t-regression.html"><i class="fa fa-check"></i><b>4</b> Robust t-regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="robust-t-regression.html"><a href="robust-t-regression.html#motivation"><i class="fa fa-check"></i><b>4.1</b> Motivation</a></li>
<li class="chapter" data-level="4.2" data-path="robust-t-regression.html"><a href="robust-t-regression.html#concepts-and-code"><i class="fa fa-check"></i><b>4.2</b> Concepts and code</a></li>
<li class="chapter" data-level="4.3" data-path="robust-t-regression.html"><a href="robust-t-regression.html#conclusion-1"><i class="fa fa-check"></i><b>4.3</b> Conclusion</a></li>
<li class="chapter" data-level="4.4" data-path="robust-t-regression.html"><a href="robust-t-regression.html#references-2"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html"><i class="fa fa-check"></i><b>5</b> Bayesian Regularized Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#regularized-regression"><i class="fa fa-check"></i><b>5.2</b> Regularized Regression</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-ridge-regression"><i class="fa fa-check"></i><b>5.2.1</b> Bayesian Ridge Regression</a></li>
<li class="chapter" data-level="5.2.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-lasso-regression"><i class="fa fa-check"></i><b>5.2.2</b> Bayesian LASSO Regression</a></li>
<li class="chapter" data-level="5.2.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#hierarchical-shrinkage"><i class="fa fa-check"></i><b>5.2.3</b> Hierarchical shrinkage</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#conclusion-2"><i class="fa fa-check"></i><b>5.3</b> Conclusion</a></li>
<li class="chapter" data-level="5.4" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#references-3"><i class="fa fa-check"></i><b>5.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html"><i class="fa fa-check"></i><b>6</b> Bayesian Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#model-specification"><i class="fa fa-check"></i><b>6.1</b> Model Specification</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-bayesqr-package"><i class="fa fa-check"></i><b>6.1.1</b> Using bayesQR package</a></li>
<li class="chapter" data-level="6.1.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-brms-package"><i class="fa fa-check"></i><b>6.1.2</b> Using brms package</a></li>
<li class="chapter" data-level="6.1.3" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#backend-stan-model"><i class="fa fa-check"></i><b>6.1.3</b> Backend stan model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#references-4"><i class="fa fa-check"></i><b>6.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html"><i class="fa fa-check"></i><b>7</b> Bayesian Multilevel (Mixed Effects) Regression in Stan</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#multilevel-regression"><i class="fa fa-check"></i><b>7.2</b> Multilevel Regression</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-intercepts-model"><i class="fa fa-check"></i><b>7.2.1</b> Bayesian Random Intercepts Model</a></li>
<li class="chapter" data-level="7.2.2" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-slopes-model"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian Random Slopes Model</a></li>
<li class="chapter" data-level="7.2.3" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#hierarchical-priors-model"><i class="fa fa-check"></i><b>7.2.3</b> Hierarchical Priors Model</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#conclusion-3"><i class="fa fa-check"></i><b>7.3</b> Conclusion</a></li>
<li class="chapter" data-level="7.4" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#references-5"><i class="fa fa-check"></i><b>7.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html"><i class="fa fa-check"></i><b>8</b> Gaussian Process Regression (GPR)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#challenges"><i class="fa fa-check"></i><b>8.2</b> Challenges</a></li>
<li class="chapter" data-level="8.3" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#gpfit-package"><i class="fa fa-check"></i><b>8.3</b> GPfit package</a></li>
<li class="chapter" data-level="8.4" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#bayesian-stan"><i class="fa fa-check"></i><b>8.4</b> Bayesian Stan</a></li>
<li class="chapter" data-level="8.5" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#references-6"><i class="fa fa-check"></i><b>8.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html"><i class="fa fa-check"></i><b>9</b> Bayesian Gaussian Mixture Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#single-varaible-example"><i class="fa fa-check"></i><b>9.1</b> Single varaible example</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#example-with-multiple-variable"><i class="fa fa-check"></i><b>9.2</b> Example with multiple variable</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#conclusion-4"><i class="fa fa-check"></i><b>9.3</b> Conclusion</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#references-7"><i class="fa fa-check"></i><b>9.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>10</b> Bayesian Seasonal Decomposition in Stan and RStan</a>
<ul>
<li class="chapter" data-level="10.1" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#simulating-seasonal-time-series-data"><i class="fa fa-check"></i><b>10.1</b> Simulating Seasonal Time Series Data*</a></li>
<li class="chapter" data-level="10.2" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#bayesian-seasonal-decomposition-model-in-stan"><i class="fa fa-check"></i><b>10.2</b> Bayesian Seasonal Decomposition Model in Stan</a></li>
<li class="chapter" data-level="10.3" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#fitting-the-model-in-r"><i class="fa fa-check"></i><b>10.3</b> Fitting the Model in R</a></li>
<li class="chapter" data-level="10.4" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extracting-and-visualizing-components"><i class="fa fa-check"></i><b>10.4</b> Extracting and Visualizing Components</a></li>
<li class="chapter" data-level="10.5" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extensions-and-applications"><i class="fa fa-check"></i><b>10.5</b> Extensions and Applications</a></li>
<li class="chapter" data-level="10.6" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#conclusion-5"><i class="fa fa-check"></i><b>10.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>11</b> Bayesian Exponential Smoothing and Holt-Winters Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="11.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-simple-exponential-smoothing-ses"><i class="fa fa-check"></i><b>11.1</b> Bayesian Simple Exponential Smoothing (SES)</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model"><i class="fa fa-check"></i><b>11.1.1</b> Stan Model</a></li>
<li class="chapter" data-level="11.1.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fitting-in-r"><i class="fa fa-check"></i><b>11.1.2</b> Fitting in R</a></li>
<li class="chapter" data-level="11.1.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization"><i class="fa fa-check"></i><b>11.1.3</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-holt-winters-models"><i class="fa fa-check"></i><b>11.2</b> Bayesian Holt-Winters Models</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#without-seasonality-additive-trend"><i class="fa fa-check"></i><b>11.2.1</b> Without Seasonality (Additive Trend)</a></li>
<li class="chapter" data-level="11.2.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model-1"><i class="fa fa-check"></i><b>11.2.2</b> Stan Model</a></li>
<li class="chapter" data-level="11.2.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-1"><i class="fa fa-check"></i><b>11.2.3</b> Visualization</a></li>
<li class="chapter" data-level="11.2.4" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#with-seasonality-additive-seasonal-component"><i class="fa fa-check"></i><b>11.2.4</b> With Seasonality (Additive Seasonal Component)</a></li>
<li class="chapter" data-level="11.2.5" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fit"><i class="fa fa-check"></i><b>11.2.5</b> Fit</a></li>
<li class="chapter" data-level="11.2.6" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-2"><i class="fa fa-check"></i><b>11.2.6</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#conclusion-6"><i class="fa fa-check"></i><b>11.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>12</b> Bayesian AR, ARMA, and ARIMA Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-ar1-model"><i class="fa fa-check"></i><b>12.1</b> Bayesian AR(1) Model</a></li>
<li class="chapter" data-level="12.2" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arma11-model"><i class="fa fa-check"></i><b>12.2</b> Bayesian ARMA(1,1) Model</a></li>
<li class="chapter" data-level="12.3" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arima111-model"><i class="fa fa-check"></i><b>12.3</b> Bayesian ARIMA(1,1,1) Model</a></li>
<li class="chapter" data-level="12.4" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#conclusion-7"><i class="fa fa-check"></i><b>12.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>13</b> Appendix</a>
<ul>
<li class="chapter" data-level="13.1" data-path="appendix.html"><a href="appendix.html#main-stan-distributions-cheatsheet"><i class="fa fa-check"></i><b>13.1</b> Main Stan Distributions Cheatsheet</a></li>
<li class="chapter" data-level="13.2" data-path="appendix.html"><a href="appendix.html#main-stan-functions-cheatsheet"><i class="fa fa-check"></i><b>13.2</b> Main Stan Functions Cheatsheet</a></li>
<li class="chapter" data-level="13.3" data-path="appendix.html"><a href="appendix.html#why-non-distribution-functions"><i class="fa fa-check"></i><b>13.3</b> Why Non-Distribution Functions?</a></li>
<li class="chapter" data-level="13.4" data-path="appendix.html"><a href="appendix.html#stan-functions-cheatsheet"><i class="fa fa-check"></i><b>13.4</b> Stan Functions Cheatsheet</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="appendix.html"><a href="appendix.html#mathematical-functions"><i class="fa fa-check"></i><b>13.4.1</b> 1. Mathematical Functions</a></li>
<li class="chapter" data-level="13.4.2" data-path="appendix.html"><a href="appendix.html#transformation-functions"><i class="fa fa-check"></i><b>13.4.2</b> 2. Transformation Functions</a></li>
<li class="chapter" data-level="13.4.3" data-path="appendix.html"><a href="appendix.html#matrix-and-vector-operations"><i class="fa fa-check"></i><b>13.4.3</b> 3. Matrix and Vector Operations</a></li>
<li class="chapter" data-level="13.4.4" data-path="appendix.html"><a href="appendix.html#utility-functions"><i class="fa fa-check"></i><b>13.4.4</b> 4. Utility Functions</a></li>
<li class="chapter" data-level="13.4.5" data-path="appendix.html"><a href="appendix.html#specialized-solvers"><i class="fa fa-check"></i><b>13.4.5</b> 5. Specialized Solvers</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="appendix.html"><a href="appendix.html#example-hierarchical-linear-regression"><i class="fa fa-check"></i><b>13.5</b> Example: Hierarchical Linear Regression</a></li>
<li class="chapter" data-level="13.6" data-path="appendix.html"><a href="appendix.html#tips-for-using-stan-functions"><i class="fa fa-check"></i><b>13.6</b> Tips for Using Stan Functions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-multilevel-mixed-effects-regression-in-stan" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Bayesian Multilevel (Mixed Effects) Regression in Stan<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-multilevel-mixed-effects-regression-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-1" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this post, we will explore Bayesian multilevel (mixed effects) regression models, which extend traditional linear regression by incorporating hierarchical structures to account for grouped or clustered data. Unlike standard linear regression, which assumes observations are independent, multilevel models handle data with nested structures (e.g., students within schools, patients within hospitals) by modeling both fixed and random effects. Our goal is to understand how multilevel models pool information across groups, improve parameter estimation in the presence of group-level variation, and compare Bayesian multilevel models to their frequentist counterparts. We will focus on three specific approaches—random intercepts, random slopes, and hierarchical priors—implemented in Stan, highlighting their ability to model group-level variation and their connections to frequentist mixed effects models. Bayesian multilevel models use priors to regularize group-level parameters, producing partially pooled estimates that balance group-specific and population-level information, reducing overfitting compared to unpooled models.</p>
</div>
<div id="multilevel-regression" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Multilevel Regression<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#multilevel-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Multilevel regression models are designed to handle data with hierarchical structures, where observations are nested within groups. These models estimate fixed effects (population-level parameters) and random effects (group-specific parameters), allowing for partial pooling of information across groups. In a Bayesian framework, this is achieved by placing priors on both fixed and random effects, enabling the model to borrow strength across groups while accounting for group-level variability. We will explore random intercepts, random slopes, and hierarchical priors, implementing each in Stan and comparing their behavior.</p>
<div id="bayesian-random-intercepts-model" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Bayesian Random Intercepts Model<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-intercepts-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The random intercepts model allows each group to have its own intercept, drawn from a common distribution, while sharing the same slope across groups. This accounts for group-level variation in the baseline outcome. In a Bayesian framework, we place a normal prior on the group-specific intercepts, with a hyperprior on their standard deviation to control the degree of pooling.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-1" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb80-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-2" tabindex="-1"></a></span>
<span id="cb80-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb80-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># total observations</span></span>
<span id="cb80-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-5" tabindex="-1"></a>n_groups <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># number of groups</span></span>
<span id="cb80-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-6" tabindex="-1"></a>group_id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_groups, <span class="at">each =</span> n<span class="sc">/</span>n_groups)</span>
<span id="cb80-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-7" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">40</span>  <span class="co"># population intercept</span></span>
<span id="cb80-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-8" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">3</span>   <span class="co"># population slope</span></span>
<span id="cb80-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-9" tabindex="-1"></a>sigma_group <span class="ot">&lt;-</span> <span class="dv">5</span>  <span class="co"># SD of group intercepts</span></span>
<span id="cb80-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-10" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">4</span>       <span class="co"># residual SD</span></span>
<span id="cb80-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-11" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb80-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-12" tabindex="-1"></a>group_effects <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_groups, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma_group)</span>
<span id="cb80-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-13" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> group_effects[group_id] <span class="sc">+</span> b <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb80-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-14" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(y, x, group_id)</span>
<span id="cb80-15"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-15" tabindex="-1"></a><span class="fu">head</span>(data)</span>
<span id="cb80-16"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-16" tabindex="-1"></a></span>
<span id="cb80-17"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-17" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb80-18"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-18" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(data, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb80-19"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-19" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb80-20"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb80-20" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb81-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb81-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;               <span class="co">// number of observations</span></span>
<span id="cb81-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; J;               <span class="co">// number of groups</span></span>
<span id="cb81-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-4" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;                  <span class="co">// outcome</span></span>
<span id="cb81-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-5" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;                  <span class="co">// predictor</span></span>
<span id="cb81-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-6" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=J&gt; group_id[N];  <span class="co">// group index</span></span>
<span id="cb81-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-7" tabindex="-1"></a>}</span>
<span id="cb81-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-8" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb81-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-9" tabindex="-1"></a>  <span class="dt">real</span> alpha;                   <span class="co">// population intercept</span></span>
<span id="cb81-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-10" tabindex="-1"></a>  <span class="dt">real</span> beta;                    <span class="co">// population slope</span></span>
<span id="cb81-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-11" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;          <span class="co">// residual SD</span></span>
<span id="cb81-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-12" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_group;    <span class="co">// SD of group intercepts</span></span>
<span id="cb81-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-13" tabindex="-1"></a>  <span class="dt">vector</span>[J] alpha_group;        <span class="co">// group-specific intercepts</span></span>
<span id="cb81-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-14" tabindex="-1"></a>}</span>
<span id="cb81-15"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-15" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb81-16"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-16" tabindex="-1"></a>  alpha ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);        <span class="co">// prior for population intercept</span></span>
<span id="cb81-17"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-17" tabindex="-1"></a>  beta ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);         <span class="co">// prior for population slope</span></span>
<span id="cb81-18"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-18" tabindex="-1"></a>  sigma_group ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);   <span class="co">// hyperprior for group intercept SD</span></span>
<span id="cb81-19"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-19" tabindex="-1"></a>  sigma ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);         <span class="co">// prior for residual SD</span></span>
<span id="cb81-20"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-20" tabindex="-1"></a>  alpha_group ~ normal(<span class="dv">0</span>, sigma_group);  <span class="co">// group-specific intercepts</span></span>
<span id="cb81-21"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-21" tabindex="-1"></a>  y ~ normal(alpha + alpha_group[group_id] + beta * x, sigma);  <span class="co">// likelihood</span></span>
<span id="cb81-22"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb81-22" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-1" tabindex="-1"></a><span class="fu">writeLines</span>(stan_mod_random_intercepts, <span class="at">con =</span> <span class="st">&quot;random_intercepts.stan&quot;</span>)</span>
<span id="cb82-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-2" tabindex="-1"></a></span>
<span id="cb82-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb82-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-4" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb82-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-5" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(train_data),</span>
<span id="cb82-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-6" tabindex="-1"></a>  <span class="at">J =</span> <span class="fu">length</span>(<span class="fu">unique</span>(train_data<span class="sc">$</span>group_id)),</span>
<span id="cb82-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-7" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>y,</span>
<span id="cb82-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-8" tabindex="-1"></a>  <span class="at">x =</span> train_data<span class="sc">$</span>x,</span>
<span id="cb82-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-9" tabindex="-1"></a>  <span class="at">group_id =</span> train_data<span class="sc">$</span>group_id</span>
<span id="cb82-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-10" tabindex="-1"></a>)</span>
<span id="cb82-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-11" tabindex="-1"></a></span>
<span id="cb82-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-12" tabindex="-1"></a>fit_rstan <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">stan</span>(</span>
<span id="cb82-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-13" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;random_intercepts.stan&quot;</span>,</span>
<span id="cb82-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-14" tabindex="-1"></a>  <span class="at">data =</span> stan_data</span>
<span id="cb82-15"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb82-15" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="bayesian-random-slopes-model" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Bayesian Random Slopes Model<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-slopes-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The random slopes model extends the random intercepts model by allowing each group to have its own slope in addition to its intercept. This is useful when the effect of a predictor varies across groups. In the Bayesian framework, we place normal priors on both group-specific intercepts and slopes, with hyperpriors on their standard deviations to control pooling.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb83-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb83-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;               <span class="co">// number of observations</span></span>
<span id="cb83-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; J;               <span class="co">// number of groups</span></span>
<span id="cb83-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-4" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;                  <span class="co">// outcome</span></span>
<span id="cb83-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-5" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;                  <span class="co">// predictor</span></span>
<span id="cb83-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-6" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=J&gt; group_id[N];  <span class="co">// group index</span></span>
<span id="cb83-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-7" tabindex="-1"></a>}</span>
<span id="cb83-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-8" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb83-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-9" tabindex="-1"></a>  <span class="dt">real</span> alpha;                   <span class="co">// population intercept</span></span>
<span id="cb83-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-10" tabindex="-1"></a>  <span class="dt">real</span> beta;                    <span class="co">// population slope</span></span>
<span id="cb83-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-11" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;          <span class="co">// residual SD</span></span>
<span id="cb83-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-12" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_group_alpha;  <span class="co">// SD of group intercepts</span></span>
<span id="cb83-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-13" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_group_beta;   <span class="co">// SD of group slopes</span></span>
<span id="cb83-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-14" tabindex="-1"></a>  <span class="dt">vector</span>[J] alpha_group;        <span class="co">// group-specific intercepts</span></span>
<span id="cb83-15"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-15" tabindex="-1"></a>  <span class="dt">vector</span>[J] beta_group;         <span class="co">// group-specific slopes</span></span>
<span id="cb83-16"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-16" tabindex="-1"></a>}</span>
<span id="cb83-17"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-17" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb83-18"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-18" tabindex="-1"></a>  alpha ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);        <span class="co">// prior for population intercept</span></span>
<span id="cb83-19"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-19" tabindex="-1"></a>  beta ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);         <span class="co">// prior for population slope</span></span>
<span id="cb83-20"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-20" tabindex="-1"></a>  sigma_group_alpha ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);  <span class="co">// hyperprior for group intercept SD</span></span>
<span id="cb83-21"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-21" tabindex="-1"></a>  sigma_group_beta ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);   <span class="co">// hyperprior for group slope SD</span></span>
<span id="cb83-22"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-22" tabindex="-1"></a>  sigma ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);         <span class="co">// prior for residual SD</span></span>
<span id="cb83-23"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-23" tabindex="-1"></a>  alpha_group ~ normal(<span class="dv">0</span>, sigma_group_alpha);  <span class="co">// group-specific intercepts</span></span>
<span id="cb83-24"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-24" tabindex="-1"></a>  beta_group ~ normal(<span class="dv">0</span>, sigma_group_beta);    <span class="co">// group-specific slopes</span></span>
<span id="cb83-25"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-25" tabindex="-1"></a>  y ~ normal(alpha + alpha_group[group_id] + (beta + beta_group[group_id]) * x, sigma);  <span class="co">// likelihood</span></span>
<span id="cb83-26"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-26" tabindex="-1"></a>}</span>
<span id="cb83-27"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-27" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb83-28"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-28" tabindex="-1"></a>  <span class="dt">vector</span>[N] y_pred;             <span class="co">// predicted values</span></span>
<span id="cb83-29"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-29" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb83-30"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-30" tabindex="-1"></a>    y_pred[n] = normal_rng(alpha + alpha_group[group_id[n]] + (beta + beta_group[group_id[n]]) * x[n], sigma);</span>
<span id="cb83-31"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-31" tabindex="-1"></a>  }</span>
<span id="cb83-32"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb83-32" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-1" tabindex="-1"></a><span class="fu">writeLines</span>(stan_mod_random_slopes, <span class="at">con =</span> <span class="st">&quot;random_slopes.stan&quot;</span>)</span>
<span id="cb84-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-2" tabindex="-1"></a></span>
<span id="cb84-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-3" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb84-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-4" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(train_data),</span>
<span id="cb84-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-5" tabindex="-1"></a>  <span class="at">J =</span> <span class="fu">length</span>(<span class="fu">unique</span>(train_data<span class="sc">$</span>group_id)),</span>
<span id="cb84-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-6" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>y,</span>
<span id="cb84-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-7" tabindex="-1"></a>  <span class="at">x =</span> train_data<span class="sc">$</span>x,</span>
<span id="cb84-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-8" tabindex="-1"></a>  <span class="at">group_id =</span> train_data<span class="sc">$</span>group_id</span>
<span id="cb84-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-9" tabindex="-1"></a>)</span>
<span id="cb84-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-10" tabindex="-1"></a></span>
<span id="cb84-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-11" tabindex="-1"></a>fit_rstan2 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">stan</span>(</span>
<span id="cb84-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-12" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;random_slopes.stan&quot;</span>,</span>
<span id="cb84-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-13" tabindex="-1"></a>  <span class="at">data =</span> stan_data</span>
<span id="cb84-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb84-14" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="hierarchical-priors-model" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Hierarchical Priors Model<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#hierarchical-priors-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For more complex hierarchies, we can use hierarchical priors to model group-level parameters with greater flexibility, allowing for correlations between random intercepts and slopes. This approach uses a multivariate normal prior for the group-specific effects, with a covariance matrix to capture dependencies between intercepts and slopes.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb85-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-1" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb85-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-2" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;               <span class="co">// number of observations</span></span>
<span id="cb85-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-3" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; J;               <span class="co">// number of groups</span></span>
<span id="cb85-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-4" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;                  <span class="co">// outcome</span></span>
<span id="cb85-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-5" tabindex="-1"></a>  <span class="dt">vector</span>[N] x;                  <span class="co">// predictor</span></span>
<span id="cb85-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-6" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=J&gt; group_id[N];  <span class="co">// group index</span></span>
<span id="cb85-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-7" tabindex="-1"></a>}</span>
<span id="cb85-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-8" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb85-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-9" tabindex="-1"></a>  <span class="dt">real</span> alpha;                   <span class="co">// population intercept</span></span>
<span id="cb85-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-10" tabindex="-1"></a>  <span class="dt">real</span> beta;                    <span class="co">// population slope</span></span>
<span id="cb85-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-11" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;          <span class="co">// residual SD</span></span>
<span id="cb85-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-12" tabindex="-1"></a>  <span class="dt">vector</span>[<span class="dv">2</span>] group_effects[J];   <span class="co">// group-specific intercept and slope</span></span>
<span id="cb85-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-13" tabindex="-1"></a>  <span class="dt">cholesky_factor_corr</span>[<span class="dv">2</span>] L;    <span class="co">// Cholesky factor of correlation matrix</span></span>
<span id="cb85-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-14" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[<span class="dv">2</span>] sigma_group;  <span class="co">// SDs for intercept and slope</span></span>
<span id="cb85-15"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-15" tabindex="-1"></a>}</span>
<span id="cb85-16"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-16" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb85-17"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-17" tabindex="-1"></a>  <span class="dt">matrix</span>[<span class="dv">2</span>, <span class="dv">2</span>] Sigma;           <span class="co">// covariance matrix</span></span>
<span id="cb85-18"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-18" tabindex="-1"></a>  Sigma = diag_pre_multiply(sigma_group, L) * diag_pre_multiply(sigma_group, L)&#39;;</span>
<span id="cb85-19"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-19" tabindex="-1"></a>}</span>
<span id="cb85-20"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-20" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb85-21"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-21" tabindex="-1"></a>  alpha ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);        <span class="co">// prior for population intercept</span></span>
<span id="cb85-22"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-22" tabindex="-1"></a>  beta ~ normal(<span class="dv">0</span>, <span class="dv">10</span>);         <span class="co">// prior for population slope</span></span>
<span id="cb85-23"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-23" tabindex="-1"></a>  sigma_group ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);   <span class="co">// hyperprior for group SDs</span></span>
<span id="cb85-24"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-24" tabindex="-1"></a>  sigma ~ cauchy(<span class="dv">0</span>, <span class="dv">5</span>);         <span class="co">// prior for residual SD</span></span>
<span id="cb85-25"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-25" tabindex="-1"></a>  L ~ lkj_corr_cholesky(<span class="dv">2</span>);     <span class="co">// prior for correlation matrix</span></span>
<span id="cb85-26"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-26" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span>:J) {</span>
<span id="cb85-27"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-27" tabindex="-1"></a>    group_effects[j] ~ multi_normal_cholesky([<span class="dv">0</span>, <span class="dv">0</span>]&#39;, diag_pre_multiply(sigma_group, L));</span>
<span id="cb85-28"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-28" tabindex="-1"></a>  }</span>
<span id="cb85-29"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-29" tabindex="-1"></a>  y ~ normal(alpha + group_effects[group_id, <span class="dv">1</span>] + (beta + group_effects[group_id, <span class="dv">2</span>]) * x, sigma);  <span class="co">// likelihood</span></span>
<span id="cb85-30"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-30" tabindex="-1"></a>}</span>
<span id="cb85-31"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-31" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb85-32"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-32" tabindex="-1"></a>  <span class="dt">vector</span>[N] y_pred;             <span class="co">// predicted values</span></span>
<span id="cb85-33"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-33" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb85-34"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-34" tabindex="-1"></a>    y_pred[n] = normal_rng(alpha + group_effects[group_id[n], <span class="dv">1</span>] + (beta + group_effects[group_id[n], <span class="dv">2</span>]) * x[n], sigma);</span>
<span id="cb85-35"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-35" tabindex="-1"></a>  }</span>
<span id="cb85-36"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb85-36" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-1" tabindex="-1"></a><span class="fu">writeLines</span>(stan_mod_hierarchical, <span class="at">con =</span> <span class="st">&quot;hierarchical_priors.stan&quot;</span>)</span>
<span id="cb86-2"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-2" tabindex="-1"></a></span>
<span id="cb86-3"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-3" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb86-4"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-4" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(train_data),</span>
<span id="cb86-5"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-5" tabindex="-1"></a>  <span class="at">J =</span> <span class="fu">length</span>(<span class="fu">unique</span>(train_data<span class="sc">$</span>group_id)),</span>
<span id="cb86-6"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-6" tabindex="-1"></a>  <span class="at">y =</span> train_data<span class="sc">$</span>y,</span>
<span id="cb86-7"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-7" tabindex="-1"></a>  <span class="at">x =</span> train_data<span class="sc">$</span>x,</span>
<span id="cb86-8"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-8" tabindex="-1"></a>  <span class="at">group_id =</span> train_data<span class="sc">$</span>group_id</span>
<span id="cb86-9"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-9" tabindex="-1"></a>)</span>
<span id="cb86-10"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-10" tabindex="-1"></a></span>
<span id="cb86-11"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-11" tabindex="-1"></a>fit_rstan3 <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">stan</span>(</span>
<span id="cb86-12"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-12" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;hierarchical_priors.stan&quot;</span>,</span>
<span id="cb86-13"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-13" tabindex="-1"></a>  <span class="at">data =</span> stan_data</span>
<span id="cb86-14"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#cb86-14" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="conclusion-3" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Conclusion<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#conclusion-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this post, we explored Bayesian multilevel regression models, which extend traditional linear regression to handle hierarchical data structures. We learned that multilevel models account for group-level variation through random effects, providing partially pooled estimates that balance group-specific and population-level information. This reduces overfitting compared to unpooled models and improves performance in settings with clustered data. We implemented random intercepts, random slopes, and hierarchical priors models in Stan, demonstrating how Bayesian priors regularize group-level parameters and capture complex dependencies. Unlike frequentist mixed effects models, Bayesian approaches provide full posterior distributions for all parameters, eliminating the need for bootstrapping to estimate uncertainty.</p>
</div>
<div id="references-5" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> References<a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#references-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://mc-stan.org/docs/stan-users-guide/hierarchical.html">Stan User’s Guide on Hierarchical Models</a></li>
<li><a href="https://rpsychologist.com/bayesian-hierarchical-regression">Blogpost on Bayesian Multilevel Modeling</a></li>
<li><a href="https://www.cambridge.org/core/books/data-analysis-using-regression-and-multilevelhierarchical-models/9780521686891">Gelman, A., &amp; Hill, J. (2006). Data Analysis Using Regression and Multilevel/Hierarchical Models</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-quantile-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gaussian-process-regression-gpr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/edit/main/07-MLM.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/blob/main/07-MLM.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
