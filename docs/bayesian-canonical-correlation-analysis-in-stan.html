<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Bayesian Canonical Correlation Analysis in Stan | Stan Bookdown</title>
  <meta name="description" content="Chapter 10 Bayesian Canonical Correlation Analysis in Stan | Stan Bookdown" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Bayesian Canonical Correlation Analysis in Stan | Stan Bookdown" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Bayesian Canonical Correlation Analysis in Stan | Stan Bookdown" />
  
  
  

<meta name="author" content="Kamran Afzali" />


<meta name="date" content="2025-09-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayesian-gaussian-mixture-models.html"/>
<link rel="next" href="bayesian-seasonal-decomposition-in-stan-and-rstan.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Stan</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Choosing the Right Bayesian Model</a></li>
<li class="chapter" data-level="2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html"><i class="fa fa-check"></i><b>2</b> Bayesian Modeling in R and Stan</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#what-is-stan"><i class="fa fa-check"></i><b>2.1</b> What is <code>stan</code>?</a></li>
<li class="chapter" data-level="2.2" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#model-file"><i class="fa fa-check"></i><b>2.2</b> Model file</a></li>
<li class="chapter" data-level="2.3" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#fit-the-model"><i class="fa fa-check"></i><b>2.3</b> Fit the model</a></li>
<li class="chapter" data-level="2.4" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#mcmc-diagnostics"><i class="fa fa-check"></i><b>2.4</b> MCMC diagnostics</a></li>
<li class="chapter" data-level="2.5" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#conclusions"><i class="fa fa-check"></i><b>2.5</b> Conclusions</a></li>
<li class="chapter" data-level="2.6" data-path="bayesian-modeling-in-r-and-stan.html"><a href="bayesian-modeling-in-r-and-stan.html#references"><i class="fa fa-check"></i><b>2.6</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html"><i class="fa fa-check"></i><b>3</b> Bayesian Regression Models for Non-Normal Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#logistic-regression"><i class="fa fa-check"></i><b>3.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="3.2" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#negative-binomial"><i class="fa fa-check"></i><b>3.2</b> Negative Binomial</a></li>
<li class="chapter" data-level="3.3" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#conclusion"><i class="fa fa-check"></i><b>3.3</b> Conclusion</a></li>
<li class="chapter" data-level="3.4" data-path="bayesian-regression-models-for-non-normal-data.html"><a href="bayesian-regression-models-for-non-normal-data.html#references-1"><i class="fa fa-check"></i><b>3.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="robust-t-regression.html"><a href="robust-t-regression.html"><i class="fa fa-check"></i><b>4</b> Robust t-regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="robust-t-regression.html"><a href="robust-t-regression.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="robust-t-regression.html"><a href="robust-t-regression.html#concepts-and-code"><i class="fa fa-check"></i><b>4.2</b> Concepts and code</a></li>
<li class="chapter" data-level="4.3" data-path="robust-t-regression.html"><a href="robust-t-regression.html#conclusion-1"><i class="fa fa-check"></i><b>4.3</b> Conclusion</a></li>
<li class="chapter" data-level="4.4" data-path="robust-t-regression.html"><a href="robust-t-regression.html#references-2"><i class="fa fa-check"></i><b>4.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html"><i class="fa fa-check"></i><b>5</b> Bayesian Regularized Regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#introduction-1"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#ridge-regression-and-gaussian-priors"><i class="fa fa-check"></i><b>5.2</b> Ridge Regression and Gaussian Priors</a></li>
<li class="chapter" data-level="5.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#lasso-regression-and-laplace-priors"><i class="fa fa-check"></i><b>5.3</b> LASSO Regression and Laplace Priors</a></li>
<li class="chapter" data-level="5.4" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#hierarchical-shrinkage-and-adaptive-priors"><i class="fa fa-check"></i><b>5.4</b> Hierarchical Shrinkage and Adaptive Priors</a></li>
<li class="chapter" data-level="5.5" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#implementation"><i class="fa fa-check"></i><b>5.5</b> Implementation</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-ridge-regression"><i class="fa fa-check"></i><b>5.5.1</b> Bayesian Ridge Regression</a></li>
<li class="chapter" data-level="5.5.2" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#bayesian-lasso-regression"><i class="fa fa-check"></i><b>5.5.2</b> Bayesian LASSO Regression</a></li>
<li class="chapter" data-level="5.5.3" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#hierarchical-shrinkage-horseshoe-prior"><i class="fa fa-check"></i><b>5.5.3</b> Hierarchical Shrinkage (Horseshoe Prior)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#empirical-comparison-and-model-evaluation"><i class="fa fa-check"></i><b>5.6</b> Empirical Comparison and Model Evaluation</a></li>
<li class="chapter" data-level="5.7" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#understanding-posterior-behavior"><i class="fa fa-check"></i><b>5.7</b> Understanding Posterior Behavior</a></li>
<li class="chapter" data-level="5.8" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#choosing-among-regularization-methods"><i class="fa fa-check"></i><b>5.8</b> Choosing Among Regularization Methods</a></li>
<li class="chapter" data-level="5.9" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#conclusion-2"><i class="fa fa-check"></i><b>5.9</b> Conclusion</a></li>
<li class="chapter" data-level="5.10" data-path="bayesian-regularized-regression.html"><a href="bayesian-regularized-regression.html#references-3"><i class="fa fa-check"></i><b>5.10</b> References</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html"><i class="fa fa-check"></i><b>6</b> Bayesian Quantile Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#model-specification"><i class="fa fa-check"></i><b>6.1</b> Model Specification</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-bayesqr-package"><i class="fa fa-check"></i><b>6.1.1</b> Using bayesQR package</a></li>
<li class="chapter" data-level="6.1.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#using-brms-package"><i class="fa fa-check"></i><b>6.1.2</b> Using brms package</a></li>
<li class="chapter" data-level="6.1.3" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#backend-stan-model"><i class="fa fa-check"></i><b>6.1.3</b> Backend stan model</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="bayesian-quantile-regression.html"><a href="bayesian-quantile-regression.html#references-4"><i class="fa fa-check"></i><b>6.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html"><i class="fa fa-check"></i><b>7</b> Bayesian Multilevel (Mixed Effects) Regression in Stan</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#introduction-2"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#multilevel-regression"><i class="fa fa-check"></i><b>7.2</b> Multilevel Regression</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-intercepts-model"><i class="fa fa-check"></i><b>7.2.1</b> Bayesian Random Intercepts Model</a></li>
<li class="chapter" data-level="7.2.2" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#bayesian-random-slopes-model"><i class="fa fa-check"></i><b>7.2.2</b> Bayesian Random Slopes Model</a></li>
<li class="chapter" data-level="7.2.3" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#hierarchical-priors-model"><i class="fa fa-check"></i><b>7.2.3</b> Hierarchical Priors Model</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#conclusion-3"><i class="fa fa-check"></i><b>7.3</b> Conclusion</a></li>
<li class="chapter" data-level="7.4" data-path="bayesian-multilevel-mixed-effects-regression-in-stan.html"><a href="bayesian-multilevel-mixed-effects-regression-in-stan.html#references-5"><i class="fa fa-check"></i><b>7.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html"><i class="fa fa-check"></i><b>8</b> Gaussian Process Regression (GPR)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#introduction-3"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#challenges"><i class="fa fa-check"></i><b>8.2</b> Challenges</a></li>
<li class="chapter" data-level="8.3" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#gpfit-package"><i class="fa fa-check"></i><b>8.3</b> GPfit package</a></li>
<li class="chapter" data-level="8.4" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#bayesian-stan"><i class="fa fa-check"></i><b>8.4</b> Bayesian Stan</a></li>
<li class="chapter" data-level="8.5" data-path="gaussian-process-regression-gpr.html"><a href="gaussian-process-regression-gpr.html#references-6"><i class="fa fa-check"></i><b>8.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html"><i class="fa fa-check"></i><b>9</b> Bayesian Gaussian Mixture Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#single-varaible-example"><i class="fa fa-check"></i><b>9.1</b> Single varaible example</a></li>
<li class="chapter" data-level="9.2" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#example-with-multiple-variable"><i class="fa fa-check"></i><b>9.2</b> Example with multiple variable</a></li>
<li class="chapter" data-level="9.3" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#conclusion-4"><i class="fa fa-check"></i><b>9.3</b> Conclusion</a></li>
<li class="chapter" data-level="9.4" data-path="bayesian-gaussian-mixture-models.html"><a href="bayesian-gaussian-mixture-models.html#references-7"><i class="fa fa-check"></i><b>9.4</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html"><i class="fa fa-check"></i><b>10</b> Bayesian Canonical Correlation Analysis in Stan</a>
<ul>
<li class="chapter" data-level="10.1" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#introduction-4"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#canonical-correlation-analysis"><i class="fa fa-check"></i><b>10.1.1</b> Canonical Correlation Analysis</a></li>
<li class="chapter" data-level="10.1.2" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#stan-model"><i class="fa fa-check"></i><b>10.1.2</b> Stan Model</a></li>
<li class="chapter" data-level="10.1.3" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#model-validation-on-test-set"><i class="fa fa-check"></i><b>10.1.3</b> Model validation on test set</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#conclusion-5"><i class="fa fa-check"></i><b>10.2</b> Conclusion</a></li>
<li class="chapter" data-level="10.3" data-path="bayesian-canonical-correlation-analysis-in-stan.html"><a href="bayesian-canonical-correlation-analysis-in-stan.html#references-8"><i class="fa fa-check"></i><b>10.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>11</b> Bayesian Seasonal Decomposition in Stan and RStan</a>
<ul>
<li class="chapter" data-level="11.1" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#simulating-seasonal-time-series-data"><i class="fa fa-check"></i><b>11.1</b> Simulating Seasonal Time Series Data*</a></li>
<li class="chapter" data-level="11.2" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#bayesian-seasonal-decomposition-model-in-stan"><i class="fa fa-check"></i><b>11.2</b> Bayesian Seasonal Decomposition Model in Stan</a></li>
<li class="chapter" data-level="11.3" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#fitting-the-model-in-r"><i class="fa fa-check"></i><b>11.3</b> Fitting the Model in R</a></li>
<li class="chapter" data-level="11.4" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extracting-and-visualizing-components"><i class="fa fa-check"></i><b>11.4</b> Extracting and Visualizing Components</a></li>
<li class="chapter" data-level="11.5" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#extensions-and-applications"><i class="fa fa-check"></i><b>11.5</b> Extensions and Applications</a></li>
<li class="chapter" data-level="11.6" data-path="bayesian-seasonal-decomposition-in-stan-and-rstan.html"><a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html#conclusion-6"><i class="fa fa-check"></i><b>11.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>12</b> Bayesian Exponential Smoothing and Holt-Winters Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="12.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-simple-exponential-smoothing-ses"><i class="fa fa-check"></i><b>12.1</b> Bayesian Simple Exponential Smoothing (SES)</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model-1"><i class="fa fa-check"></i><b>12.1.1</b> Stan Model</a></li>
<li class="chapter" data-level="12.1.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fitting-in-r"><i class="fa fa-check"></i><b>12.1.2</b> Fitting in R</a></li>
<li class="chapter" data-level="12.1.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization"><i class="fa fa-check"></i><b>12.1.3</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#bayesian-holt-winters-models"><i class="fa fa-check"></i><b>12.2</b> Bayesian Holt-Winters Models</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#without-seasonality-additive-trend"><i class="fa fa-check"></i><b>12.2.1</b> Without Seasonality (Additive Trend)</a></li>
<li class="chapter" data-level="12.2.2" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#stan-model-2"><i class="fa fa-check"></i><b>12.2.2</b> Stan Model</a></li>
<li class="chapter" data-level="12.2.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-1"><i class="fa fa-check"></i><b>12.2.3</b> Visualization</a></li>
<li class="chapter" data-level="12.2.4" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#with-seasonality-additive-seasonal-component"><i class="fa fa-check"></i><b>12.2.4</b> With Seasonality (Additive Seasonal Component)</a></li>
<li class="chapter" data-level="12.2.5" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#fit"><i class="fa fa-check"></i><b>12.2.5</b> Fit</a></li>
<li class="chapter" data-level="12.2.6" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#visualization-2"><i class="fa fa-check"></i><b>12.2.6</b> Visualization</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html"><a href="bayesian-exponential-smoothing-and-holt-winters-models-in-stan-and-rstan.html#conclusion-7"><i class="fa fa-check"></i><b>12.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><i class="fa fa-check"></i><b>13</b> Bayesian AR, ARMA, and ARIMA Models in Stan and RStan</a>
<ul>
<li class="chapter" data-level="13.1" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-ar1-model"><i class="fa fa-check"></i><b>13.1</b> Bayesian AR(1) Model</a></li>
<li class="chapter" data-level="13.2" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arma11-model"><i class="fa fa-check"></i><b>13.2</b> Bayesian ARMA(1,1) Model</a></li>
<li class="chapter" data-level="13.3" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#bayesian-arima111-model"><i class="fa fa-check"></i><b>13.3</b> Bayesian ARIMA(1,1,1) Model</a></li>
<li class="chapter" data-level="13.4" data-path="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html"><a href="bayesian-ar-arma-and-arima-models-in-stan-and-rstan.html#conclusion-8"><i class="fa fa-check"></i><b>13.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html"><i class="fa fa-check"></i><b>14</b> 14 Bayesian Structural Time Series Models</a>
<ul>
<li class="chapter" data-level="14.1" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#introduction-5"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#stan-implementation-basic-bsts-model"><i class="fa fa-check"></i><b>14.1.1</b> Stan Implementation: Basic BSTS Model</a></li>
<li class="chapter" data-level="14.1.2" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#stan-implementation-time-varying-trend-volatility"><i class="fa fa-check"></i><b>14.1.2</b> Stan Implementation: Time-Varying Trend Volatility</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#model-comparison-and-selection"><i class="fa fa-check"></i><b>14.2</b> Model Comparison and Selection</a></li>
<li class="chapter" data-level="14.3" data-path="bayesian-structural-time-series-models.html"><a href="bayesian-structural-time-series-models.html#conclusion-9"><i class="fa fa-check"></i><b>14.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html"><i class="fa fa-check"></i><b>15</b> Model Comparison and Selection in Bayesian Analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#introduction-6"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#posterior-predictive-checks"><i class="fa fa-check"></i><b>15.2</b> Posterior Predictive Checks</a></li>
<li class="chapter" data-level="15.3" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#information-criteria-waic-and-loo-cv"><i class="fa fa-check"></i><b>15.3</b> Information Criteria: WAIC and LOO-CV</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#waic-watanabe-akaike-information-criterion"><i class="fa fa-check"></i><b>15.3.1</b> WAIC (Watanabe-Akaike Information Criterion)</a></li>
<li class="chapter" data-level="15.3.2" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#loo-cv-leave-one-out-cross-validation"><i class="fa fa-check"></i><b>15.3.2</b> LOO-CV (Leave-One-Out Cross-Validation)</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#bayes-factors-vs.-information-criteria"><i class="fa fa-check"></i><b>15.4</b> Bayes Factors vs.Â Information Criteria</a></li>
<li class="chapter" data-level="15.5" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#summary-of-bayesian-model-comparison-methods"><i class="fa fa-check"></i><b>15.5</b> Summary of Bayesian Model Comparison Methods</a></li>
<li class="chapter" data-level="15.6" data-path="model-comparison-and-selection-in-bayesian-analysis.html"><a href="model-comparison-and-selection-in-bayesian-analysis.html#practical-example-comparing-models-in-r"><i class="fa fa-check"></i><b>15.6</b> Practical Example: Comparing Models in R</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>16</b> Appendix</a>
<ul>
<li class="chapter" data-level="16.1" data-path="appendix.html"><a href="appendix.html#main-stan-distributions-cheatsheet"><i class="fa fa-check"></i><b>16.1</b> Main Stan Distributions Cheatsheet</a></li>
<li class="chapter" data-level="16.2" data-path="appendix.html"><a href="appendix.html#main-stan-functions-cheatsheet"><i class="fa fa-check"></i><b>16.2</b> Main Stan Functions Cheatsheet</a></li>
<li class="chapter" data-level="16.3" data-path="appendix.html"><a href="appendix.html#why-non-distribution-functions"><i class="fa fa-check"></i><b>16.3</b> Why Non-Distribution Functions?</a></li>
<li class="chapter" data-level="16.4" data-path="appendix.html"><a href="appendix.html#stan-functions-cheatsheet"><i class="fa fa-check"></i><b>16.4</b> Stan Functions Cheatsheet</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="appendix.html"><a href="appendix.html#mathematical-functions"><i class="fa fa-check"></i><b>16.4.1</b> 1. Mathematical Functions</a></li>
<li class="chapter" data-level="16.4.2" data-path="appendix.html"><a href="appendix.html#transformation-functions"><i class="fa fa-check"></i><b>16.4.2</b> 2. Transformation Functions</a></li>
<li class="chapter" data-level="16.4.3" data-path="appendix.html"><a href="appendix.html#matrix-and-vector-operations"><i class="fa fa-check"></i><b>16.4.3</b> 3. Matrix and Vector Operations</a></li>
<li class="chapter" data-level="16.4.4" data-path="appendix.html"><a href="appendix.html#utility-functions"><i class="fa fa-check"></i><b>16.4.4</b> 4. Utility Functions</a></li>
<li class="chapter" data-level="16.4.5" data-path="appendix.html"><a href="appendix.html#specialized-solvers"><i class="fa fa-check"></i><b>16.4.5</b> 5. Specialized Solvers</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="appendix.html"><a href="appendix.html#example-hierarchical-linear-regression"><i class="fa fa-check"></i><b>16.5</b> Example: Hierarchical Linear Regression</a></li>
<li class="chapter" data-level="16.6" data-path="appendix.html"><a href="appendix.html#tips-for-using-stan-functions"><i class="fa fa-check"></i><b>16.6</b> Tips for Using Stan Functions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Bookdown</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bayesian-canonical-correlation-analysis-in-stan" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Bayesian Canonical Correlation Analysis in Stan<a href="bayesian-canonical-correlation-analysis-in-stan.html#bayesian-canonical-correlation-analysis-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-4" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Introduction<a href="bayesian-canonical-correlation-analysis-in-stan.html#introduction-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Canonical Correlation Analysis (CCA) is a multivariate statistical method that identifies and quantifies the relationships between two sets of variables by finding linear combinations (canonical variates) that maximize their correlation. Unlike standard correlation analysis, which examines relationships between individual variables, CCA explores the joint structure of two variable sets, such as psychological test scores and academic performance metrics. In a Bayesian framework, CCA incorporates priors on the canonical coefficients, allowing for uncertainty quantification and regularization, which can improve estimation in small or noisy datasets. In this post, we will implement a Bayesian CCA model in Stan, focusing on estimating canonical coefficients and their correlations, and compare it to frequentist CCA. We will use synthetic data to illustrate the approach and highlight the benefits of Bayesian inference, such as full posterior distributions for uncertainty quantification.</p>
<div id="canonical-correlation-analysis" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Canonical Correlation Analysis<a href="bayesian-canonical-correlation-analysis-in-stan.html#canonical-correlation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>CCA seeks pairs of linear combinations (canonical variates) from two sets of variables, <span class="math inline">\(X \in \mathbb{R}^{n \times p}\)</span> (with <span class="math inline">\(p\)</span> variables) and <span class="math inline">\(Y \in \mathbb{R}^{n \times q}\)</span> (with <span class="math inline">\(q\)</span> variables), such that the correlation between the variates is maximized. Mathematically, for variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, CCA finds vectors <span class="math inline">\(a_i \in \mathbb{R}^p\)</span> and <span class="math inline">\(b_i \in \mathbb{R}^q\)</span> such that the canonical variates <span class="math inline">\(U_i = X a_i\)</span> and <span class="math inline">\(V_i = Y b_i\)</span> have maximum correlation, i.e.,</p>
<p><span class="math display">\[
(a_i, b_i) = \arg\max_{a, b} \; \text{corr}(X a, Y b),
\]</span></p>
<p>subject to the constraints that the variates are uncorrelated with previous pairs,</p>
<p><span class="math display">\[
\text{cov}(X a_i, X a_j) = 0, \quad \text{cov}(Y b_i, Y b_j) = 0 \quad \text{for } i \neq j,
\]</span></p>
<p>and have unit variance:</p>
<p><span class="math display">\[
\text{var}(X a_i) = \text{var}(Y b_i) = 1.
\]</span></p>
<p>In a Bayesian framework, we place priors on the canonical coefficients (<span class="math inline">\(a_i\)</span>, <span class="math inline">\(b_i\)</span>) and model the joint distribution of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, allowing for flexible regularization and uncertainty estimation.</p>
<p>In the Bayesian CCA model, we assume that the observed variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are generated from latent canonical variates with a shared structure. Specifically, let</p>
<p><span class="math display">\[
U = X A, \quad V = Y B,
\]</span></p>
<p>where <span class="math inline">\(A \in \mathbb{R}^{p \times k}\)</span> and <span class="math inline">\(B \in \mathbb{R}^{q \times k}\)</span> are matrices of canonical weights, and <span class="math inline">\(k \leq \min(p, q)\)</span> is the number of canonical components.</p>
<p>We place normal priors on the canonical coefficients:</p>
<p><span class="math display">\[
A_{ij} \sim \mathcal{N}(0, \sigma^2_A), \quad B_{ij} \sim \mathcal{N}(0, \sigma^2_B),
\]</span></p>
<p>and use a multivariate normal likelihood to model the joint distribution of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>:</p>
<p><span class="math display">\[
\begin{bmatrix}
X \\
Y
\end{bmatrix}
\sim \mathcal{N} \left(
\begin{bmatrix}
0 \\
0
\end{bmatrix},
\Sigma
\right),
\]</span></p>
<p>with the cross-covariance structure implied by the canonical correlation:</p>
<p><span class="math display">\[
\Sigma =
\begin{bmatrix}
\Sigma_{XX} &amp; \Sigma_{XY} \\
\Sigma_{YX} &amp; \Sigma_{YY}
\end{bmatrix}, \quad \Sigma_{XY} = A C B^\top,
\]</span></p>
<p>where <span class="math inline">\(C\)</span> is a diagonal matrix of canonical correlations.</p>
<p>The model estimates the canonical coefficients and their correlations, with hyperpriors to regularize the variance parameters:</p>
<p><span class="math display">\[
\sigma_A, \sigma_B \sim \text{Half-Cauchy}(0, \tau),
\]</span></p>
<p>for some scale <span class="math inline">\(\tau &gt; 0\)</span>.</p>
<p>We start by generating synthetic data to demonstrate the Bayesian CCA model.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-1" tabindex="-1"></a><span class="co"># Improved Bayesian Canonical Correlation Analysis</span></span>
<span id="cb128-2"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-2" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb128-3"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb128-4"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-4" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb128-5"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-5" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb128-6"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-6" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb128-7"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb128-8"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-8" tabindex="-1"></a></span>
<span id="cb128-9"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-9" tabindex="-1"></a><span class="co"># Set Stan options for better performance</span></span>
<span id="cb128-10"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-10" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb128-11"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-11" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-12"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-12" tabindex="-1"></a></span>
<span id="cb128-13"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-13" tabindex="-1"></a><span class="co"># Data Generation with more realistic structure</span></span>
<span id="cb128-14"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-14" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb128-15"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-15" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># number of observations</span></span>
<span id="cb128-16"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-16" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">4</span>     <span class="co"># number of X variables (increased for more complexity)</span></span>
<span id="cb128-17"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-17" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">3</span>     <span class="co"># number of Y variables (increased for more complexity)</span></span>
<span id="cb128-18"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-18" tabindex="-1"></a></span>
<span id="cb128-19"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-19" tabindex="-1"></a><span class="co"># Generate multiple latent canonical variates for richer structure</span></span>
<span id="cb128-20"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-20" tabindex="-1"></a>u1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb128-21"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-21" tabindex="-1"></a>u2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.5</span>)  <span class="co"># Secondary canonical variate</span></span>
<span id="cb128-22"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-22" tabindex="-1"></a></span>
<span id="cb128-23"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-23" tabindex="-1"></a><span class="co"># Create correlated canonical variates for Y</span></span>
<span id="cb128-24"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-24" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fl">0.8</span> <span class="sc">*</span> u1 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.8</span><span class="sc">^</span><span class="dv">2</span>))  <span class="co"># Strong correlation</span></span>
<span id="cb128-25"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-25" tabindex="-1"></a>v2 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> u2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span>))  <span class="co"># Moderate correlation</span></span>
<span id="cb128-26"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-26" tabindex="-1"></a></span>
<span id="cb128-27"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-27" tabindex="-1"></a><span class="co"># Generate X variables with varying loadings on canonical variates</span></span>
<span id="cb128-28"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-28" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fl">0.9</span> <span class="sc">*</span> u1 <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> u2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb128-29"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-29" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fl">0.7</span> <span class="sc">*</span> u1 <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> u2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.6</span>)</span>
<span id="cb128-30"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-30" tabindex="-1"></a>X3 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> u1 <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> u2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.4</span>)</span>
<span id="cb128-31"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-31" tabindex="-1"></a>X4 <span class="ot">&lt;-</span> <span class="fl">0.3</span> <span class="sc">*</span> u1 <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> u2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb128-32"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-32" tabindex="-1"></a></span>
<span id="cb128-33"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-33" tabindex="-1"></a><span class="co"># Generate Y variables with varying loadings</span></span>
<span id="cb128-34"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-34" tabindex="-1"></a>Y1 <span class="ot">&lt;-</span> <span class="fl">0.8</span> <span class="sc">*</span> v1 <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> v2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.4</span>)</span>
<span id="cb128-35"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-35" tabindex="-1"></a>Y2 <span class="ot">&lt;-</span> <span class="fl">0.6</span> <span class="sc">*</span> v1 <span class="sc">+</span> <span class="fl">0.7</span> <span class="sc">*</span> v2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb128-36"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-36" tabindex="-1"></a>Y3 <span class="ot">&lt;-</span> <span class="fl">0.4</span> <span class="sc">*</span> v1 <span class="sc">+</span> <span class="fl">0.9</span> <span class="sc">*</span> v2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb128-37"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-37" tabindex="-1"></a></span>
<span id="cb128-38"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-38" tabindex="-1"></a><span class="co"># Create properly structured data frame</span></span>
<span id="cb128-39"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-39" tabindex="-1"></a>X_matrix <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X1, X2, X3, X4)</span>
<span id="cb128-40"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-40" tabindex="-1"></a>Y_matrix <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y1, Y2, Y3)</span>
<span id="cb128-41"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-41" tabindex="-1"></a></span>
<span id="cb128-42"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-42" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb128-43"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-43" tabindex="-1"></a>  X_matrix,</span>
<span id="cb128-44"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-44" tabindex="-1"></a>  Y_matrix</span>
<span id="cb128-45"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-45" tabindex="-1"></a>)</span>
<span id="cb128-46"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-46" tabindex="-1"></a></span>
<span id="cb128-47"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-47" tabindex="-1"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb128-48"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-48" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">&quot;X&quot;</span>, <span class="dv">1</span><span class="sc">:</span>p), <span class="fu">paste0</span>(<span class="st">&quot;Y&quot;</span>, <span class="dv">1</span><span class="sc">:</span>q))</span>
<span id="cb128-49"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-49" tabindex="-1"></a></span>
<span id="cb128-50"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb128-50" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Data structure:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Data structure:</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb130-1" tabindex="-1"></a><span class="fu">str</span>(data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    1000 obs. of  7 variables:
##  $ X1: num  -0.5555 -0.0381 1.7356 -0.5984 -1.2791 ...
##  $ X2: num  -0.93779 0.25544 0.39843 0.90492 0.00288 ...
##  $ X3: num  -0.958 -0.132 0.495 -0.059 -0.714 ...
##  $ X4: num  -1.562 0.13 1.988 0.489 1.17 ...
##  $ Y1: num  -0.476 0.581 -0.195 0.618 0.381 ...
##  $ Y2: num  0.247 -0.714 -0.609 -0.468 2.619 ...
##  $ Y3: num  0.0679 -0.5563 -0.4859 -0.4285 1.6024 ...</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb132-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">First few rows:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## First few rows:</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb134-1" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##           X1           X2          X3         X4         Y1         Y2          Y3
## 1 -0.5555230 -0.937786961 -0.95824856 -1.5621519 -0.4756980  0.2471985  0.06787267
## 2 -0.0380964  0.255443076 -0.13249015  0.1302962  0.5808467 -0.7141092 -0.55628658
## 3  1.7356425  0.398431031  0.49506392  1.9876149 -0.1951641 -0.6091259 -0.48588501
## 4 -0.5984476  0.904923249 -0.05900908  0.4894344  0.6179522 -0.4680525 -0.42848716
## 5 -1.2790972  0.002880448 -0.71354682  1.1697318  0.3812883  2.6194768  1.60241228
## 6  2.8023075  1.661767465  1.03054388  0.5010812  0.6960511  0.4003202  0.94571908</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-1" tabindex="-1"></a><span class="co"># Data splitting</span></span>
<span id="cb136-2"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb136-3"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-3" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(data, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb136-4"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-4" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb136-5"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-5" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span>
<span id="cb136-6"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-6" tabindex="-1"></a></span>
<span id="cb136-7"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-7" tabindex="-1"></a><span class="co"># Extract X and Y matrices correctly</span></span>
<span id="cb136-8"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-8" tabindex="-1"></a>X_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, <span class="dv">1</span><span class="sc">:</span>p])</span>
<span id="cb136-9"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-9" tabindex="-1"></a>Y_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, (p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>q)])</span>
<span id="cb136-10"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-10" tabindex="-1"></a></span>
<span id="cb136-11"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-11" tabindex="-1"></a>X_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="dv">1</span><span class="sc">:</span>p])</span>
<span id="cb136-12"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb136-12" tabindex="-1"></a>Y_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, (p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(p<span class="sc">+</span>q)])</span></code></pre></div>
</div>
<div id="stan-model" class="section level3 hasAnchor" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Stan Model<a href="bayesian-canonical-correlation-analysis-in-stan.html#stan-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below is the Stan code for a Bayesian CCA model, which estimates the canonical coefficients for one pair of canonical variates.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-1" tabindex="-1"></a>stan_model <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb137-2"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-2" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb137-3"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-3" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;               // number of observations</span></span>
<span id="cb137-4"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-4" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; p;               // number of X variables</span></span>
<span id="cb137-5"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-5" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; q;               // number of Y variables</span></span>
<span id="cb137-6"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-6" tabindex="-1"></a><span class="st">  matrix[N, p] X;               // X variables (standardized)</span></span>
<span id="cb137-7"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-7" tabindex="-1"></a><span class="st">  matrix[N, q] Y;               // Y variables (standardized)</span></span>
<span id="cb137-8"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-8" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb137-9"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-9" tabindex="-1"></a></span>
<span id="cb137-10"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-10" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb137-11"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-11" tabindex="-1"></a><span class="st">  vector[p] a;                  // canonical coefficients for X</span></span>
<span id="cb137-12"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-12" tabindex="-1"></a><span class="st">  vector[q] b;                  // canonical coefficients for Y</span></span>
<span id="cb137-13"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-13" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma_u;        // SD for canonical variate u</span></span>
<span id="cb137-14"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-14" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma_v;        // SD for canonical variate v</span></span>
<span id="cb137-15"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-15" tabindex="-1"></a><span class="st">  real&lt;lower=-1, upper=1&gt; rho;  // canonical correlation</span></span>
<span id="cb137-16"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-16" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-17"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-17" tabindex="-1"></a><span class="st">  // Hierarchical priors for better regularization</span></span>
<span id="cb137-18"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-18" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; tau_a;          // hierarchical scale for a</span></span>
<span id="cb137-19"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-19" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; tau_b;          // hierarchical scale for b</span></span>
<span id="cb137-20"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-20" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb137-21"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-21" tabindex="-1"></a></span>
<span id="cb137-22"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-22" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb137-23"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-23" tabindex="-1"></a><span class="st">  vector[N] u;                  // canonical variate for X</span></span>
<span id="cb137-24"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-24" tabindex="-1"></a><span class="st">  vector[N] v;                  // canonical variate for Y</span></span>
<span id="cb137-25"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-25" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-26"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-26" tabindex="-1"></a><span class="st">  // Compute canonical variates</span></span>
<span id="cb137-27"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-27" tabindex="-1"></a><span class="st">  u = X * a;</span></span>
<span id="cb137-28"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-28" tabindex="-1"></a><span class="st">  v = Y * b;</span></span>
<span id="cb137-29"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-29" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-30"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-30" tabindex="-1"></a><span class="st">  // Standardize canonical variates for identifiability</span></span>
<span id="cb137-31"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-31" tabindex="-1"></a><span class="st">  real u_mean = mean(u);</span></span>
<span id="cb137-32"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-32" tabindex="-1"></a><span class="st">  real v_mean = mean(v);</span></span>
<span id="cb137-33"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-33" tabindex="-1"></a><span class="st">  real u_sd = sd(u);</span></span>
<span id="cb137-34"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-34" tabindex="-1"></a><span class="st">  real v_sd = sd(v);</span></span>
<span id="cb137-35"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-35" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb137-36"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-36" tabindex="-1"></a></span>
<span id="cb137-37"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-37" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb137-38"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-38" tabindex="-1"></a><span class="st">  // Hierarchical priors</span></span>
<span id="cb137-39"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-39" tabindex="-1"></a><span class="st">  tau_a ~ cauchy(0, 1);</span></span>
<span id="cb137-40"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-40" tabindex="-1"></a><span class="st">  tau_b ~ cauchy(0, 1);</span></span>
<span id="cb137-41"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-41" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-42"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-42" tabindex="-1"></a><span class="st">  // Priors for canonical coefficients with hierarchical regularization</span></span>
<span id="cb137-43"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-43" tabindex="-1"></a><span class="st">  a ~ normal(0, tau_a);</span></span>
<span id="cb137-44"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-44" tabindex="-1"></a><span class="st">  b ~ normal(0, tau_b);</span></span>
<span id="cb137-45"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-45" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-46"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-46" tabindex="-1"></a><span class="st">  // Priors for variance parameters</span></span>
<span id="cb137-47"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-47" tabindex="-1"></a><span class="st">  sigma_u ~ cauchy(0, 1);</span></span>
<span id="cb137-48"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-48" tabindex="-1"></a><span class="st">  sigma_v ~ cauchy(0, 1);</span></span>
<span id="cb137-49"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-49" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-50"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-50" tabindex="-1"></a><span class="st">  // Prior for canonical correlation</span></span>
<span id="cb137-51"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-51" tabindex="-1"></a><span class="st">  rho ~ beta(2, 2);  // Slightly informative prior favoring moderate correlations</span></span>
<span id="cb137-52"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-52" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-53"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-53" tabindex="-1"></a><span class="st">  // Likelihood for canonical variates</span></span>
<span id="cb137-54"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-54" tabindex="-1"></a><span class="st">  u ~ normal(0, sigma_u);</span></span>
<span id="cb137-55"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-55" tabindex="-1"></a><span class="st">  v ~ normal(rho * u, sigma_v * sqrt(1 - rho^2));</span></span>
<span id="cb137-56"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-56" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-57"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-57" tabindex="-1"></a><span class="st">  // Constraint for identifiability (optional - can help with convergence)</span></span>
<span id="cb137-58"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-58" tabindex="-1"></a><span class="st">  target += -0.5 * dot_self(a) - 0.5 * dot_self(b);</span></span>
<span id="cb137-59"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-59" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb137-60"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-60" tabindex="-1"></a></span>
<span id="cb137-61"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-61" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb137-62"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-62" tabindex="-1"></a><span class="st">  // Posterior predictions</span></span>
<span id="cb137-63"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-63" tabindex="-1"></a><span class="st">  vector[N] u_pred;</span></span>
<span id="cb137-64"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-64" tabindex="-1"></a><span class="st">  vector[N] v_pred;</span></span>
<span id="cb137-65"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-65" tabindex="-1"></a><span class="st">  matrix[N, p] X_pred;</span></span>
<span id="cb137-66"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-66" tabindex="-1"></a><span class="st">  matrix[N, q] Y_pred;</span></span>
<span id="cb137-67"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-67" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-68"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-68" tabindex="-1"></a><span class="st">  // Log likelihood for model comparison</span></span>
<span id="cb137-69"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-69" tabindex="-1"></a><span class="st">  real log_lik = 0;</span></span>
<span id="cb137-70"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-70" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-71"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-71" tabindex="-1"></a><span class="st">  // Generate predictions</span></span>
<span id="cb137-72"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-72" tabindex="-1"></a><span class="st">  for (n in 1:N) {</span></span>
<span id="cb137-73"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-73" tabindex="-1"></a><span class="st">    u_pred[n] = normal_rng(0, sigma_u);</span></span>
<span id="cb137-74"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-74" tabindex="-1"></a><span class="st">    v_pred[n] = normal_rng(rho * u_pred[n], sigma_v * sqrt(1 - rho^2));</span></span>
<span id="cb137-75"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-75" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb137-76"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-76" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-77"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-77" tabindex="-1"></a><span class="st">  // Predicted X and Y based on canonical variates</span></span>
<span id="cb137-78"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-78" tabindex="-1"></a><span class="st">  X_pred = rep_matrix(u_pred, p);</span></span>
<span id="cb137-79"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-79" tabindex="-1"></a><span class="st">  Y_pred = rep_matrix(v_pred, q);</span></span>
<span id="cb137-80"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-80" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb137-81"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-81" tabindex="-1"></a><span class="st">  // Calculate log likelihood</span></span>
<span id="cb137-82"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-82" tabindex="-1"></a><span class="st">  for (n in 1:N) {</span></span>
<span id="cb137-83"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-83" tabindex="-1"></a><span class="st">    log_lik += normal_lpdf(u[n] | 0, sigma_u);</span></span>
<span id="cb137-84"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-84" tabindex="-1"></a><span class="st">    log_lik += normal_lpdf(v[n] | rho * u[n], sigma_v * sqrt(1 - rho^2));</span></span>
<span id="cb137-85"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-85" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb137-86"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-86" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb137-87"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb137-87" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<p>This Stan model implements Bayesian Canonical Correlation Analysis by first defining the data structure with <code>N</code> observations, <code>p</code> X variables, and <code>q</code> Y variables stored in matrices <code>X</code> and <code>Y</code>. The parameters section declares the key unknowns: canonical coefficient vectors <code>a</code> and <code>b</code> that will create linear combinations of the original variables, standard deviations <code>sigma_u</code> and <code>sigma_v</code> for the canonical variates, the canonical correlation <code>rho</code> (constrained between -1 and 1), and hierarchical regularization parameters <code>tau_a</code> and <code>tau_b</code>. In the transformed parameters block, the model computes the canonical variates <code>u = X * a</code> and <code>v = Y * b</code>, which are the linear combinations that maximize correlation between the two sets of variables, along with their means and standard deviations for standardization purposes.</p>
<p>The model block establishes the probabilistic relationships through priors and likelihood functions. Hierarchical priors are set with <code>tau_a ~ cauchy(0, 1)</code> and <code>tau_b ~ cauchy(0, 1)</code>, which then inform the canonical coefficients <code>a ~ normal(0, tau_a)</code> and <code>b ~ normal(0, tau_b)</code>, providing adaptive regularization. The variance parameters <code>sigma_u</code> and <code>sigma_v</code> receive Cauchy priors, while <code>rho</code> gets a Beta(2,2) prior favoring moderate correlations. The core likelihood assumes <code>u ~ normal(0, sigma_u)</code> and <code>v ~ normal(rho * u, sigma_v * sqrt(1 - rho^2))</code>, establishing that the canonical variates follow a bivariate normal distribution with correlation <code>rho</code>. The model adds an identifiability constraint <code>target += -0.5 * dot_self(a) - 0.5 * dot_self(b)</code> to prevent scaling issues. Finally, the generated quantities block creates posterior predictions by sampling new canonical variates <code>u_pred</code> and <code>v_pred</code> from their respective distributions, generates predicted data matrices <code>X_pred</code> and <code>Y_pred</code>, and computes the log-likelihood <code>log_lik</code> for model comparison purposes.</p>
<div id="fitting-the-model" class="section level4 hasAnchor" number="10.1.2.1">
<h4><span class="header-section-number">10.1.2.1</span> Fitting the Model<a href="bayesian-canonical-correlation-analysis-in-stan.html#fitting-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Prepare the data and fit the model using <code>rstan</code>.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-1" tabindex="-1"></a>X_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_train)</span>
<span id="cb138-2"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-2" tabindex="-1"></a>Y_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(Y_train)</span>
<span id="cb138-3"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-3" tabindex="-1"></a></span>
<span id="cb138-4"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-4" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb138-5"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-5" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(X_scaled),</span>
<span id="cb138-6"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-6" tabindex="-1"></a>  <span class="at">p =</span> <span class="fu">ncol</span>(X_scaled),</span>
<span id="cb138-7"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-7" tabindex="-1"></a>  <span class="at">q =</span> <span class="fu">ncol</span>(Y_scaled),</span>
<span id="cb138-8"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-8" tabindex="-1"></a>  <span class="at">X =</span> X_scaled,</span>
<span id="cb138-9"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-9" tabindex="-1"></a>  <span class="at">Y =</span> Y_scaled</span>
<span id="cb138-10"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-10" tabindex="-1"></a>)</span>
<span id="cb138-11"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-11" tabindex="-1"></a></span>
<span id="cb138-12"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-12" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Stan data structure:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-13"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-13" tabindex="-1"></a><span class="fu">str</span>(stan_data)</span>
<span id="cb138-14"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-14" tabindex="-1"></a></span>
<span id="cb138-15"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-15" tabindex="-1"></a><span class="co"># Compile and fit the model</span></span>
<span id="cb138-16"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Compiling and fitting Stan model...</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-17"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-17" tabindex="-1"></a>fit_cca <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb138-18"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-18" tabindex="-1"></a>  <span class="at">model_code =</span> stan_model,</span>
<span id="cb138-19"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-19" tabindex="-1"></a>  <span class="at">data =</span> stan_data,</span>
<span id="cb138-20"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-20" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>,</span>
<span id="cb138-21"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-21" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb138-22"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-22" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb138-23"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-23" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb138-24"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-24" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>, <span class="at">max_treedepth =</span> <span class="dv">12</span>),</span>
<span id="cb138-25"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-25" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb138-26"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-26" tabindex="-1"></a>)</span>
<span id="cb138-27"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-27" tabindex="-1"></a></span>
<span id="cb138-28"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-28" tabindex="-1"></a><span class="co"># Model diagnostics</span></span>
<span id="cb138-29"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-29" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Model Summary:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-30"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-30" tabindex="-1"></a><span class="fu">print</span>(fit_cca, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;rho&quot;</span>, <span class="st">&quot;sigma_u&quot;</span>, <span class="st">&quot;sigma_v&quot;</span>, <span class="st">&quot;tau_a&quot;</span>, <span class="st">&quot;tau_b&quot;</span>))</span>
<span id="cb138-31"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-31" tabindex="-1"></a></span>
<span id="cb138-32"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-32" tabindex="-1"></a><span class="co"># Check convergence diagnostics</span></span>
<span id="cb138-33"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-33" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Convergence Diagnostics:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-34"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;R-hat values:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-35"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-35" tabindex="-1"></a>rhat_values <span class="ot">&lt;-</span> <span class="fu">rhat</span>(fit_cca)</span>
<span id="cb138-36"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-36" tabindex="-1"></a><span class="fu">print</span>(rhat_values[rhat_values <span class="sc">&gt;</span> <span class="fl">1.1</span>])</span>
<span id="cb138-37"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-37" tabindex="-1"></a></span>
<span id="cb138-38"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-38" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Effective sample sizes:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-39"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-39" tabindex="-1"></a>eff_samples <span class="ot">&lt;-</span> <span class="fu">neff_ratio</span>(fit_cca)</span>
<span id="cb138-40"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-40" tabindex="-1"></a><span class="fu">print</span>(eff_samples[eff_samples <span class="sc">&lt;</span> <span class="fl">0.1</span>])</span>
<span id="cb138-41"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-41" tabindex="-1"></a></span>
<span id="cb138-42"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-42" tabindex="-1"></a><span class="co"># Extract posterior samples</span></span>
<span id="cb138-43"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-43" tabindex="-1"></a>posterior_samples <span class="ot">&lt;-</span> <span class="fu">extract</span>(fit_cca)</span>
<span id="cb138-44"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-44" tabindex="-1"></a></span>
<span id="cb138-45"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-45" tabindex="-1"></a><span class="co"># Visualization of results</span></span>
<span id="cb138-46"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-46" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(bayesplot)) {</span>
<span id="cb138-47"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-47" tabindex="-1"></a>  <span class="co"># Trace plots for key parameters</span></span>
<span id="cb138-48"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-48" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(fit_cca, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;rho&quot;</span>, <span class="st">&quot;sigma_u&quot;</span>, <span class="st">&quot;sigma_v&quot;</span>))</span>
<span id="cb138-49"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-49" tabindex="-1"></a>  </span>
<span id="cb138-50"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-50" tabindex="-1"></a>  <span class="co"># Posterior density plots</span></span>
<span id="cb138-51"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-51" tabindex="-1"></a>  <span class="fu">mcmc_dens</span>(fit_cca, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;rho&quot;</span>, <span class="st">&quot;sigma_u&quot;</span>, <span class="st">&quot;sigma_v&quot;</span>))</span>
<span id="cb138-52"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-52" tabindex="-1"></a>  </span>
<span id="cb138-53"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-53" tabindex="-1"></a>  <span class="co"># Posterior intervals for canonical coefficients</span></span>
<span id="cb138-54"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-54" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>(fit_cca, <span class="at">pars =</span> <span class="fu">paste0</span>(<span class="st">&quot;a[&quot;</span>, <span class="dv">1</span><span class="sc">:</span>p, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb138-55"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-55" tabindex="-1"></a>  <span class="fu">mcmc_intervals</span>(fit_cca, <span class="at">pars =</span> <span class="fu">paste0</span>(<span class="st">&quot;b[&quot;</span>, <span class="dv">1</span><span class="sc">:</span>q, <span class="st">&quot;]&quot;</span>))</span>
<span id="cb138-56"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-56" tabindex="-1"></a>}</span>
<span id="cb138-57"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-57" tabindex="-1"></a></span>
<span id="cb138-58"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-58" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb138-59"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-59" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Posterior Summary for Key Parameters:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-60"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-60" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Canonical Correlation (rho):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-61"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-61" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mean:&quot;</span>, <span class="fu">mean</span>(posterior_samples<span class="sc">$</span>rho), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-62"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-62" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% CI:&quot;</span>, <span class="fu">quantile</span>(posterior_samples<span class="sc">$</span>rho, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-63"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-63" tabindex="-1"></a></span>
<span id="cb138-64"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-64" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Canonical Coefficients for X (a):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-65"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-65" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colMeans</span>(posterior_samples<span class="sc">$</span>a))</span>
<span id="cb138-66"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-66" tabindex="-1"></a></span>
<span id="cb138-67"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-67" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Canonical Coefficients for Y (b):</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb138-68"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb138-68" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colMeans</span>(posterior_samples<span class="sc">$</span>b))</span></code></pre></div>
</div>
</div>
<div id="model-validation-on-test-set" class="section level3 hasAnchor" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> Model validation on test set<a href="bayesian-canonical-correlation-analysis-in-stan.html#model-validation-on-test-set" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-1" tabindex="-1"></a>X_test_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(X_test, <span class="at">center =</span> <span class="fu">attr</span>(X_scaled, <span class="st">&quot;scaled:center&quot;</span>), </span>
<span id="cb139-2"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-2" tabindex="-1"></a>                       <span class="at">scale =</span> <span class="fu">attr</span>(X_scaled, <span class="st">&quot;scaled:scale&quot;</span>))</span>
<span id="cb139-3"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-3" tabindex="-1"></a>Y_test_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(Y_test, <span class="at">center =</span> <span class="fu">attr</span>(Y_scaled, <span class="st">&quot;scaled:center&quot;</span>), </span>
<span id="cb139-4"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-4" tabindex="-1"></a>                       <span class="at">scale =</span> <span class="fu">attr</span>(Y_scaled, <span class="st">&quot;scaled:scale&quot;</span>))</span>
<span id="cb139-5"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-5" tabindex="-1"></a></span>
<span id="cb139-6"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-6" tabindex="-1"></a><span class="co"># Calculate canonical variates for test set</span></span>
<span id="cb139-7"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-7" tabindex="-1"></a>a_mean <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(posterior_samples<span class="sc">$</span>a)</span>
<span id="cb139-8"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-8" tabindex="-1"></a>b_mean <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(posterior_samples<span class="sc">$</span>b)</span>
<span id="cb139-9"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-9" tabindex="-1"></a></span>
<span id="cb139-10"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-10" tabindex="-1"></a>u_test <span class="ot">&lt;-</span> X_test_scaled <span class="sc">%*%</span> a_mean</span>
<span id="cb139-11"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-11" tabindex="-1"></a>v_test <span class="ot">&lt;-</span> Y_test_scaled <span class="sc">%*%</span> b_mean</span>
<span id="cb139-12"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-12" tabindex="-1"></a></span>
<span id="cb139-13"><a href="bayesian-canonical-correlation-analysis-in-stan.html#cb139-13" tabindex="-1"></a>test_correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(u_test, v_test)</span></code></pre></div>
</div>
</div>
<div id="conclusion-5" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Conclusion<a href="bayesian-canonical-correlation-analysis-in-stan.html#conclusion-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this post, we explored Bayesian Canonical Correlation Analysis, a method to uncover relationships between two sets of variables through maximally correlated linear combinations. By implementing a Bayesian CCA model in Stan, we demonstrated how priors on canonical coefficients and hyperpriors on variance parameters enable robust estimation and uncertainty quantification. Compared to frequentist CCA, the Bayesian approach provides full posterior distributions, eliminating the need for bootstrapping to estimate uncertainty. This makes it particularly useful for small or noisy datasets. The Stan implementation allows for flexible extensions, such as modeling multiple canonical pairs or incorporating hierarchical structures.</p>
</div>
<div id="references-8" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> References<a href="bayesian-canonical-correlation-analysis-in-stan.html#references-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Stan Userâs Guide on Multivariate Models</li>
<li>Gelman, A., &amp; Hill, J. (2006). <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em></li>
<li>Krzanowski, W. J. (2000). <em>Principles of Multivariate Analysis</em></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayesian-gaussian-mixture-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-seasonal-decomposition-in-stan-and-rstan.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/edit/main/10-CNCLCOR.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/Kamran-Afzali/Bookdown_Stan/blob/main/10-CNCLCOR.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
